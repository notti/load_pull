\documentclass{beamer}
\usepackage{etex}
\usepackage{pgfpages}

\usepackage{ifthen}

\providecommand{\NoExternal}{false}
\providecommand{\NoNotes}{true}

\ifthenelse{\equal{\NoNotes}{true}}{

}{
    \setbeameroption{show notes on second screen=right}
}
\makeatletter
\defbeamertemplate*{note page}{mynotes}
{%
  {%
    \scriptsize
    \usebeamerfont{note title}\usebeamercolor[fg]{note title}%
    \ifbeamercolorempty[bg]{note title}{}{%
      \insertvrule{.45\paperheight}{note title.bg}%
      \vskip-.45\paperheight%
      \nointerlineskip%
    }%
    \vbox{
      \hfill\insertslideintonotes{0.45}\hskip-\Gm@rmargin\hskip0pt%
      \vskip-0.45\paperheight%
      }
    \nointerlineskip
    \vbox to .45\paperheight{\vskip0.5em
      \hbox{\insertshorttitle[width=8cm]}%
      \setbox\beamer@tempbox=\hbox{\insertsection}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsection\end{minipage}}\fi%
      }%
      \setbox\beamer@tempbox=\hbox{\insertsubsection}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip17.4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsubsection\end{minipage}}\fi%
      }%
      \setbox\beamer@tempbox=\hbox{\insertshortframetitle}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip30.8pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\insertshortframetitle[width=7cm]}\fi%
      }%
      \vfil
      \insertframenumber\,/\,\inserttotalframenumber}%
  }%
  \ifbeamercolorempty[bg]{note page}{}{%
    \nointerlineskip%
    \insertvrule{.55\paperheight}{note page.bg}%
    \vskip-.55\paperheight%
  }%
  \vskip.25em
  \nointerlineskip
  \insertnote
}
\makeatother

\setbeamertemplate{note page}[mynotes]

\title[FPGA based LP]{Diploma thesis}
\author[G.~Vormayr]{Gernot Vormayr\\0425210}
\institute[EMCE]{Institute of Electrodynamics, Microwave and Circuit Engineering}
\date[MW '15]{Microwave Engineering 2015}
\subtitle{FPGA based Load-Pull Measurement System}

\mode<presentation>
{
    \usetheme{CambridgeUS}
    \usecolortheme{dolphin} %whale?
    \usefonttheme{professionalfonts}
    \setbeamertemplate{navigation symbols}{}
}

\AtBeginSection[]
{
  \begin{frame}<beamer>{Outline}
    \tableofcontents[currentsection]
  \end{frame}
}
\usepackage[overlay,absolute]{textpos}
\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{1cm}
\usepackage[english]{babel}

%drawings

\usepackage{graphicx}
\graphicspath{{images/}}
\usepackage{tikz}
\usepackage{circuitikz}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{arrows}
\usetikzlibrary{backgrounds}
\usetikzlibrary{bending}
\usetikzlibrary{calc}
\usetikzlibrary{colorbrewer}
\usetikzlibrary{chains}
\usetikzlibrary{circuits.ee.IEC}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{dsp}
\usetikzlibrary{fit}
\usetikzlibrary{matrix}
\usetikzlibrary{patterns}
\usetikzlibrary{positioning}
\usetikzlibrary{scopes}
\usetikzlibrary{shadows}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}
\usepackage{tikz-timing}
\include{rfsymbols}
\makeatletter
\newcommand\currentcoordinate{\the\tikz@lastxsaved,\the\tikz@lastysaved}
\makeatother

\tikzset{
    invisible/.style={opacity=0,text opacity=0},
    visible on/.style={alt=<#1>{}{invisible}},
    alt/.code args={<#1>#2#3}{%
        \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}}
    },
    alert/.style={alt=<#1>{red!85!black}{}},
    Alert/.style={alt=#1{red!85!black}{}}
}

%units

\usepackage[binary-units,retain-explicit-plus]{siunitx}
\DeclareSIUnit \belm {Bm}
\DeclareSIUnit \belfs {BFS}
\DeclareSIUnit \samples {S}
\sisetup{per-mode = symbol}

%plots

\usepackage{pgfplots}
\pgfplotsset{compat=1.12}
\pgfplotsset{every axis/.append style={grid=major,legend style={font=\footnotesize}}}
\usepgfplotslibrary{smithchart}
\usepgfplotslibrary{units}
\usepgfplotslibrary{fillbetween}
\usepgfplotslibrary{statistics}
\usepgfplotslibrary{colorbrewer}
\pgfplotsset{unit code/.code 2 args={\si{#1#2}}}

\usepgfplotslibrary{external}
\tikzsetexternalprefix{figures/}
\ifthenelse{\equal{\NoExternal}{true}}{

}{
    \tikzexternalize[mode=list and make]
}
\tikzexternalwritetomakefile{}
\tikzexternalwritetomakefile{.DELETE_ON_ERROR:}
\tikzexternalwritetomakefile{}

%math

\usepackage{gensymb}

\providecommand{\abs}[1]{\lvert#1\rvert}

%stuff

\usepackage{url}
\usepackage{booktabs} % nicer tables

\def\device#1{\textit{#1}}


\newcommand{\backupbegin}{
   \newcounter{framenumberappendix}
   \setcounter{framenumberappendix}{\value{framenumber}}
}
\newcommand{\backupend}{
   \addtocounter{framenumberappendix}{-\value{framenumber}}
   \addtocounter{framenumber}{\value{framenumberappendix}}
}

\begin{document}

\begin{frame}
    \titlepage
\end{frame}

\begin{frame}{Outline}
  \tableofcontents
\end{frame}

\section{Introduction}

\begin{frame}{Load Pull}
    \begin{columns}
        \column{0.55\textwidth}
            \begin{exampleblock}{Passive Load Pull}
                \note[item]{Passive Load Pull: Variable Tuner $=$ Variable Impedance}
                \resizebox{!}{2.5cm}{
                \begin{tikzpicture}
                    \tikzpicturedependsonfile{rfsymbols.tex}
                    \draw node[source] (source) {}
                          node[tuner,right=of source,label=above:{Fixed Input Tuner}] (ituner) {}
                          node[dut,right=of ituner] (dut) {}
                          node[tuner,right=2 of dut,label=above:{Output Tuner}] (otuner) {}
                          node[match,right=of otuner,label=above:{$Z_0$}] (match) {}
                          node[rground,right=0.3 of match,rotate=90,anchor=center] (ground) {};
                    \draw ($(dut)!.5!(otuner)$) node[coordinate] (plane) {};

                    \draw (source) -- (ituner) -- (dut) -- (otuner) -- (match) -- (ground);

                    \draw [dashed] ($(plane) + (0,2)$) node[anchor=south] {Load Reference Plane} -- ($(plane) - (0,2.5)$);

                    \draw [latex-] ($(plane) + (0,1.5)$) -- ++(-0.5,0) node[anchor=east] {$Z_L$};

                    \draw [-latex] ($(plane) + (0.25,-1)$) node[anchor=west] {$a_2$}-- ++(-0.5,0);
                    \draw [latex-] ($(plane) + (0.25,-1.5)$) node[anchor=west] {$b_2$}-- ++(-0.5,0);
                    \draw [latex-] ($(plane) + (0,-2)$) -- ++(-0.5,0) node[anchor=east] {$\Gamma_L$};

                \end{tikzpicture}
                }
            \end{exampleblock}
            \begin{exampleblock}{Active Load Pull}
            \note[item]{Active Load Pull: Present modified $b_2$ back to DUT}
                \resizebox{!}{2.5cm}{
                \begin{tikzpicture}
                    \tikzpicturedependsonfile{rfsymbols.tex}
                    \draw node[source] (source) {}
                          node[tuner,right=of source,label=above:{Fixed Input Tuner}] (ituner) {}
                          node[dut,right=of ituner] (dut) {}
                          node[circulator,right=2 of dut] (circ) {}
                          node[vmatch,right=of circ,label=above:{Attenuator},yshift=1cm] (att) {}
                          node[vphase,right=1.5 of att,label=above:{Phase Shifter}] (phase) {}
                          node[amplifier,right=of circ,label=above:{Amplifier},yshift=-1cm] (amp) {};

                    \draw ($(dut)!.5!(circ)$) node[coordinate] (plane) {};

                    \draw (source) -- (ituner) -- (dut) -- (circ.A);
                    \draw (circ.B) -- ($(circ.B |- att)!.5!(att)$) node[coordinate] (upper) {} -- (att) -- (phase) -- ++(1,0) |- (amp) -- ($(circ.C |- amp)!.5!(amp)$) node[coordinate] (lower) {} -- (circ.C);

                    \draw [-latex] ($(circ.B) + (-0.2,0.2)$) -- node[sloped,above] {$b_2$} ($(upper) + (-0.2,0.2)$);
                    \draw [latex-] ($(circ.C) + (-0.2,-0.2)$) -- node[sloped,below] {$a_2$} ($(lower) + (-0.2,-0.2)$);

                    \draw [dashed] ($(plane) + (0,2)$) node[anchor=south] {Load Reference Plane} -- ($(plane) - (0,2.5)$);

                    \draw [latex-] ($(plane) + (0,1.5)$) -- ++(-0.5,0) node[anchor=east] {$Z_L$};

                    \draw [-latex] ($(plane) + (0.25,-1)$) node[anchor=west] {$a_2$}-- ++(-0.5,0);
                    \draw [latex-] ($(plane) + (0.25,-1.5)$) node[anchor=west] {$b_2$}-- ++(-0.5,0);
                    \draw [latex-] ($(plane) + (0,-2)$) -- ++(-0.5,0) node[anchor=east] {$\Gamma_L$};
                \end{tikzpicture}
                }
            \end{exampleblock}
        \column{0.45\textwidth}
            \begin{itemize}
                \item Transistor characterization
                \note[item]{Transistor characterization: Many parameters, hard to simulate}
                \item Amplifier design
            \end{itemize}
    \end{columns}
    \note[item]{Passive: Limited Range of 0.75 at load reference plane}
    \note[item]{Active: Oscillations (possibly fatal) Isolation vs Loop Gain}
\end{frame}

\begin{frame}
    \begin{block}{Only narrowband reflection synthesis}
        \begin{itemize}
            \item Phase delay of cabling
            \item Frequency response of components
        \end{itemize}
    \end{block}
    \begin{exampleblock}{Aim of thesis: Synthesize constant $\Gamma_L$ over bandwidths \SI{>= 20}{\mega\hertz}}
        \centering
        \begin{minipage}{.9\textwidth}
            \begin{block}{Negative phase delay}
                \begin{itemize}
                    \item Periodic waveform
                    \item Digital filter
                \end{itemize}
            \end{block}
            \begin{block}{Implementation}
                \begin{itemize}
                    \item Baseband
                    \item Digital reflection synthesis
                    \item FPGA based
                \end{itemize}
            \end{block}
        \end{minipage}
    \end{exampleblock}
\end{frame}


\section{Implementation}

\tikzset{incident/.style={color=Set1-3-1}}
\definecolor{incident}{named}{Set1-3-1}
\tikzset{reflect/.style={color=Set1-3-2}}
\definecolor{reflect}{named}{Set1-3-2}
\tikzset{generate/.style={color=Set1-3-3}}
\definecolor{generate}{named}{Set1-3-3}

\begin{frame}{System overview}
    \note[item]{One Port VNA}
    \note[item]{Analog}
    \note[item]{Digital}
    \note{\par Systematic Errors!! ($\Gamma_{L,set}$)}
    \resizebox{\linewidth}{!}{
    \begin{tikzpicture}
        \pgfmathsetseed{23654}
        \pgfdeclarelayer{foreground}
        \pgfsetlayers{background,main,foreground}
        \tikzpicturedependsonfile{rfsymbols.tex}
        \draw node[dut] (dut) {}
              node[dircoupler,right=2 of dut,label=below:dir1] (dirvna) {}
              node[oscilloscope,above=of dirvna.A2,anchor=A1] (oszivna) {}
              node[circulator,right=of dirvna,label=below:circ1] (circ) {}

              node[coordinate,right=of circ,yshift=1.5cm] (uppernode) {}
              node[coordinate,right=of circ,yshift=-1.5cm] (lowernode) {}

              (lowernode) node[amplifier,label=above:amp1] (amp) {}
              node[mixer,right=of amp,label=above:mix3] (upmix) {}
              node[lowpass,right=of upmix,label=above:lp1] (antialias) {}
              node[adc,right=of antialias,label=above:dac1] (dac) {}

              (uppernode -| upmix) node[mixer,label=below:mix1] (downmix) {}
              node[bandpass,right=of downmix,label=below:bp1] (bp) {}
              node[adc,right=of bp,label=below:adc1] (adc) {}
              node[empty,right=of adc,label=below:buffer1] (inbuf) {}
              node[mixer,right=of inbuf] (shift) {}
              node[anchor=west] at (shift.east) {mix2}

              (dac -| inbuf) node[mixer,label=above:mul1,generate] (mul) {}
              node[empty,right=of mul] (outbuf) {}
              node[anchor=north] at (outbuf.south) {buffer2}

              ($(shift)!.5!(outbuf)$) node[allpass,generate] (H) {}
              node[anchor=west] at (H.east) {fir1}

              node[source,above=of downmix.center,scale=0.7] (downsource) {}
              node[anchor=west] at (downsource.east) {lo1}
              node[source,above=of adc.center,scale=0.7] (sample) {}
              node[anchor=west] at (sample.east) {lo2}
              node[source,above=of shift.center,scale=0.7] (shiftsource) {}
              node[anchor=west] at (shiftsource.east) {lo3}
              node[source,below=of upmix.center,scale=0.7] (upsource) {}
              node[anchor=west] at (upsource.east) {lo4}
              node[below=of mul.center] (gamma) {$\Gamma_{L,set}$};

        \draw ($(dut)!.5!(dirvna)$) node[coordinate] (plane) {};

        { [rounded corners=2pt,thick]
            \draw (dut) -- (dirvna) -- (circ.A);
            \draw[incident] [-latex] (circ.B) -- ($(circ.B |- uppernode)!.5!(uppernode)$) node[coordinate] (upper) {} -- (downmix);
            \draw[incident] (dirvna.A2) -- (oszivna.A1);
            \draw[reflect] (dirvna.B2) |- ($(dirvna.B2)!.7!(oszivna.A2)$) node[coordinate] (oszimiddle) {} -| (oszivna.A2);
            \draw[reflect] [-latex] (amp) -- ($(circ.C |- amp)!.5!(lowernode)$) node[coordinate] (lower) {} -- (circ.C);
        }
        { [-latex,thick]
            \draw (downsource) -- (downmix);
            \draw (sample) -- (adc);
            \draw [double] (shiftsource) -- (shift);
            \draw[generate,double] (gamma) -- (mul);
            \draw (upsource) -- (upmix);
        }
        { [latex-,dashed,every node/.style={font=\footnotesize},thick]
            \foreach \device in {downsource,sample,shiftsource} {
                \draw (\device) -- ++(0,1) node[anchor=south] {ref};
            }
            \draw ([xshift=0.5cm]oszivna.north) -- ++(0,0.5) node[fill=white,anchor=south] {ref};
            \draw (upsource) -- ++(0,-1) node[anchor=north] {ref};
        }
        { [start chain,every on chain/.style={join=by {-latex,incident,thick}}]
            \chainin (downmix);
            \chainin (bp);
            \chainin (adc);
            \chainin (inbuf);
            \chainin (shift);
            { [every on chain/.style={join=by {double,-latex,incident,thick}}]
                \chainin (H);
                \chainin (outbuf);
                \chainin (mul);
            }
        }
        { [start chain,every on chain/.style={join=by {-latex,reflect,thick}}]
            { [every on chain/.style={join=by {double,-latex,reflect,thick}}]
                \chainin (mul);
                \chainin (dac);
                \chainin (antialias);
                \chainin (upmix);
            }
            \chainin (amp);
        }
        { [on background layer,every path/.style={dotted,decorate,decoration=random steps,segment length=2mm,thick}]
            \draw ($(dirvna.B1)!.5!(circ.A) + (0,4)$) -- ++(0,-8.5) node[coordinate] (leftsplit) {};
            \draw ($(adc.east)!.5!(mul.west) + (0,4)$) -- ++(0,-8.5) node[coordinate] (rightsplit) {};
        }

        \draw (leftsplit) node[anchor=base east] {One Port VNA}
              (leftsplit) node[anchor=base west] {Analog}
              (rightsplit) node[anchor=base west] {Digital}
              (rightsplit) node[anchor=base east] {Analog};

        \draw [dashed] ($(plane) + (0,4)$) node[anchor=south] {Load Reference Plane} -- ($(plane) - (0,4.5)$);

        \draw [latex-] ($(plane) + (0,1.5)$) -- ++(-0.5,0) node[anchor=east] {$Z_L$};

        \draw [-latex,reflect] ($(plane) + (0.25,-1.5)$) node[anchor=west] {$a_2$}-- ++(-0.5,0);
        \draw [latex-,incident] ($(plane) + (0.25,-2)$) node[anchor=west] {$b_2$}-- ++(-0.5,0);
        \draw [latex-] ($(plane) + (0,-2.5)$) -- ++(-0.5,0) node[anchor=east] {$\Gamma_L$};

        {[densely dashdotdotted,latex-latex,thick]
            \draw ($(inbuf.north) + (0,1)$) -- ++(0,1) node [anchor=south] {PC};
            \draw ([xshift=-0.5cm]oszivna.north) -- ++(0,1) node [anchor=south] {PC};
        }
    \end{tikzpicture}
    }
\end{frame}



\begin{frame}[t]{Analog Part}
    \begin{columns}
        \column{5.5cm}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}
                \pgfmathsetseed{23654}
                \pgfdeclarelayer{foreground}
                \pgfsetlayers{background,main,foreground}
                \tikzpicturedependsonfile{rfsymbols.tex}
                \draw node[coordinate] (dut) {}
                      node[circulator,right=1em of dut,label=below:circ1] (circ) {}
                      node[coordinate,right=of circ,yshift=1.5cm] (uppernode) {}
                      node[coordinate,right=of circ,yshift=-1.5cm] (lowernode) {}

                      (lowernode) node[amplifier,label=above:amp1] (amp) {}
                      node[mixer,right=of amp,label=above:mix3] (upmix) {}
                      node[lowpass,right=of upmix,label=above:lp1] (antialias) {}
                      node[adc,right=of antialias,label=above:dac1] (dac) {}
                      node[coordinate,right=of dac] (outbuf) {}

                      (uppernode -| upmix) node[mixer,label=below:mix1] (downmix) {}
                      node[bandpass,right=of downmix,label=below:bp1] (bp) {}
                      node[adc,right=of bp,label=below:adc1] (adc) {}
                      node[coordinate,right=of adc] (inbuf) {}

                      node[source,above=of downmix.center,scale=0.7] (downsource) {}
                      node[anchor=east] at (downsource.west) {$f_0 - \SI{70}{\mega\hertz}$}
                      node[anchor=west] at (downsource.east) {lo1}
                      node[source,above=of adc.center,scale=0.7] (sample) {}
                      node[anchor=east] at (sample.west) {$\SI{100}{\mega\hertz}$}
                      node[anchor=west] at (sample.east) {lo2}
                      node[source,below=of upmix.center,scale=0.7] (upsource) {}
                      node[anchor=east] at (upsource.west) {$f_0$}
                      node[anchor=west] at (upsource.east) {lo4};

                { [on background layer,every path/.style={dotted,decorate,decoration=random steps,segment length=2mm,thick}]
                    \draw ($(dut) + (0,4)$) -- ++(0,-8.5) node[coordinate] (leftsplit) {};
                    \draw ($(adc.east)!.5!(outbuf.west) + (0,4)$) -- ++(0,-8.5) node[coordinate] (rightsplit) {};
                }
                { [rounded corners=2pt,thick]
                    \draw (dut) -- (circ.A);
                    \draw [-latex,incident] (circ.B) -- ($(circ.B |- uppernode)!.5!(uppernode)$) node[coordinate] (upper) {} -- (downmix);
                    \draw [-latex,reflect] (amp) -- ($(circ.C |- amp)!.5!(lowernode)$) node[coordinate] (lower) {} -- (circ.C);
                }
                { [-latex,thick]
                    \draw (downsource) -- (downmix);
                    \draw (sample) -- (adc);
                    \draw (upsource) -- (upmix);
                }
                { [latex-,dashed,every node/.style={font=\footnotesize},thick]
                    \foreach \device in {downsource,sample} {
                        \draw (\device) -- ++(0,1) node[anchor=south] {ref};
                    }
                    \draw (upsource) -- ++(0,-1) node[anchor=north] {ref};
                }
                { [start chain,every on chain/.style={join=by {-latex,incident,thick}}]
                    \chainin (downmix);
                    \chainin (bp);
                    \chainin (adc);
                    \chainin (inbuf);
                }
                { [start chain,every on chain/.style={join=by {-latex,reflect,thick}}]
                    { [every on chain/.style={join=by {double,-latex,reflect,thick}}]
                        \chainin (outbuf);
                        \chainin (dac);
                        \chainin (antialias);
                        \chainin (upmix);
                    }
                    \chainin (amp);
                }

                \node [gray,draw,fit=(downmix) (bp) (adc),rounded corners=1pt,inner xsep=8pt,inner ysep=12pt,yshift=-4pt] {};
                %\node [draw,fit=(amp) (dac) (upsource),rounded corners=4pt,inner xsep=8pt,inner ysep=16pt,label={above:Vector Signal Generator}] {};
            \end{tikzpicture}
            }
        \column{5.8cm}
            \includegraphics[width=4.5cm]{down_adc}
            \begin{itemize}
                \item Down conversion to \SI{70}{\mega\hertz} IF
                \item \SI{16}{\bit} \SI{100}{\mega\samples\per\second} ADC
                \item Bandpass sampling
            \end{itemize}
    \end{columns}
    \begin{textblock}{4}(0,7.25)
        \resizebox{\linewidth}{!}{
        \begin{tikzpicture}
            \pgfmathsetseed{23654}
            \pgfdeclarelayer{foreground}
            \pgfsetlayers{background,main,foreground}
            \tikzpicturedependsonfile{rfsymbols.tex}
            \draw node[dut] (dut) {}
                  node[dircoupler,right=2 of dut,label=below:dir1] (dirvna) {}
                  node[oscilloscope,above=of dirvna.A2,anchor=A1] (oszivna) {}
                  node[circulator,right=of dirvna,label=below:circ1] (circ) {}

                  node[coordinate,right=of circ,yshift=1.5cm] (uppernode) {}
                  node[coordinate,right=of circ,yshift=-1.5cm] (lowernode) {}

                  (lowernode) node[amplifier,label=above:amp1] (amp) {}
                  node[mixer,right=of amp,label=above:mix3] (upmix) {}
                  node[lowpass,right=of upmix,label=above:lp1] (antialias) {}
                  node[adc,right=of antialias,label=above:dac1] (dac) {}

                  (uppernode -| upmix) node[mixer,label=below:mix1] (downmix) {}
                  node[bandpass,right=of downmix,label=below:bp1] (bp) {}
                  node[adc,right=of bp,label=below:adc1] (adc) {}
                  node[empty,right=of adc,label=below:buffer1] (inbuf) {}
                  node[mixer,right=of inbuf] (shift) {}
                  node[anchor=west] at (shift.east) {mix2}

                  (dac -| inbuf) node[mixer,label=above:mul1,generate] (mul) {}
                  node[empty,right=of mul] (outbuf) {}
                  node[anchor=north] at (outbuf.south) {buffer2}

                  ($(shift)!.5!(outbuf)$) node[allpass,generate] (H) {}
                  node[anchor=west] at (H.east) {fir1}

                  node[source,above=of downmix.center,scale=0.7] (downsource) {}
                  node[anchor=west] at (downsource.east) {lo1}
                  node[source,above=of adc.center,scale=0.7] (sample) {}
                  node[anchor=west] at (sample.east) {lo2}
                  node[source,above=of shift.center,scale=0.7] (shiftsource) {}
                  node[anchor=west] at (shiftsource.east) {lo3}
                  node[source,below=of upmix.center,scale=0.7] (upsource) {}
                  node[anchor=west] at (upsource.east) {lo4}
                  node[below=of mul.center] (gamma) {$\Gamma_{L,set}$};

            \draw ($(dut)!.5!(dirvna)$) node[coordinate] (plane) {};

            { [rounded corners=2pt,thick]
                \draw (dut) -- (dirvna) -- (circ.A);
                \draw[incident] [-latex] (circ.B) -- ($(circ.B |- uppernode)!.5!(uppernode)$) node[coordinate] (upper) {} -- (downmix);
                \draw[incident] (dirvna.A2) -- (oszivna.A1);
                \draw[reflect] (dirvna.B2) |- ($(dirvna.B2)!.7!(oszivna.A2)$) node[coordinate] (oszimiddle) {} -| (oszivna.A2);
                \draw[reflect] [-latex] (amp) -- ($(circ.C |- amp)!.5!(lowernode)$) node[coordinate] (lower) {} -- (circ.C);
            }
            { [-latex,thick]
                \draw (downsource) -- (downmix);
                \draw (sample) -- (adc);
                \draw [double] (shiftsource) -- (shift);
                \draw[generate,double] (gamma) -- (mul);
                \draw (upsource) -- (upmix);
            }
            { [latex-,dashed,every node/.style={font=\footnotesize},thick]
                \foreach \device in {downsource,sample,shiftsource} {
                    \draw (\device) -- ++(0,1) node[anchor=south] {ref};
                }
                \draw ([xshift=0.5cm]oszivna.north) -- ++(0,0.5) node[fill=white,anchor=south] {ref};
                \draw (upsource) -- ++(0,-1) node[anchor=north] {ref};
            }
            { [start chain,every on chain/.style={join=by {-latex,incident,thick}}]
                \chainin (downmix);
                \chainin (bp);
                \chainin (adc);
                \chainin (inbuf);
                \chainin (shift);
                { [every on chain/.style={join=by {double,-latex,incident,thick}}]
                    \chainin (H);
                    \chainin (outbuf);
                    \chainin (mul);
                }
            }
            { [start chain,every on chain/.style={join=by {-latex,reflect,thick}}]
                { [every on chain/.style={join=by {double,-latex,reflect,thick}}]
                    \chainin (mul);
                    \chainin (dac);
                    \chainin (antialias);
                    \chainin (upmix);
                }
                \chainin (amp);
            }
            { [on background layer]
                \clip ($(dirvna.B1)!.5!(circ.A) + (-1,-4.485)$) rectangle ($(adc.east)!.5!(mul.west) + (1,4.485)$);
                \draw[fill=red!10,dotted,thick,decoration=random steps,segment length=2mm]
                    decorate { ($(dirvna.B1)!.5!(circ.A) + (0,4.5)$) -- ++(0,-9) node[coordinate] (leftsplit) {} } --
                                 ($(adc.east)!.5!(mul.west) + (0,-4.5)$) node[coordinate] (rightsplit) {}
                    decorate { -- ++(0,9) } -- cycle;
            }

            \draw (leftsplit) node[anchor=base east] {One Port VNA}
                  (leftsplit) node[anchor=base west] {Analog}
                  (rightsplit) node[anchor=base west] {Digital}
                  (rightsplit) node[anchor=base east] {Analog};

            { [on background layer]
                \fill [red!10,rounded corners=5pt] ($(leftsplit)+(0.1,0)$) rectangle ($(rightsplit) + (-0.1,8.5)$);
            }

            \draw [dashed] ($(plane) + (0,4)$) node[anchor=south] {Load Reference Plane} -- ($(plane) - (0,4.5)$);

            \draw [latex-] ($(plane) + (0,1.5)$) -- ++(-0.5,0) node[anchor=east] {$Z_L$};

            \draw [-latex,reflect] ($(plane) + (0.25,-1.5)$) node[anchor=west] {$a_2$}-- ++(-0.5,0);
            \draw [latex-,incident] ($(plane) + (0.25,-2)$) node[anchor=west] {$b_2$}-- ++(-0.5,0);
            \draw [latex-] ($(plane) + (0,-2.5)$) -- ++(-0.5,0) node[anchor=east] {$\Gamma_L$};

            {[densely dashdotdotted,latex-latex,thick]
                \draw ($(inbuf.north) + (0,1)$) -- ++(0,1) node [anchor=south] {PC};
                \draw ([xshift=-0.5cm]oszivna.north) -- ++(0,1) node [anchor=south] {PC};
            }
        \end{tikzpicture}
        }
    \end{textblock}
\end{frame}

\tikzset{inbuf/.style={color=Set1-4-1}}
\tikzset{core/.style={color=Set1-4-2}}
\tikzset{outbuf/.style={color=Set1-4-3}}
\tikzset{pc/.style={color=Set1-4-4}}

\begin{frame}[t]{Digital Part}
    \begin{columns}[T]
        \column{2.5cm}
        \resizebox{\linewidth}{!}{
        \tikzset{external/export next=false}
        \begin{tikzpicture}
            \tikzpicturedependsonfile{rfsymbols.tex}
            \draw (0,-1.5cm) node[coordinate] (dac) {}

                  (0,1.5cm) node[coordinate] (adc) {}
                  node[empty,right=of adc,label=below:buffer1,inbuf] (inbuf) {}
                  node[mixer,right=of inbuf,core] (shift) {}
                  node[anchor=west] at (shift.east) {mix2}

                  (dac -| inbuf) node[mixer,label=above:mul1,outbuf] (mul) {}
                  node[empty,right=of mul,outbuf] (outbuf) {}
                  node[anchor=north] at (outbuf.south) {buffer2}

                  ($(shift)!.5!(outbuf)$) node[allpass,rotate=90,core] (H) {}
                  node[anchor=west] at (H.south) {fir1}

                  node[source,above=of shift.center,scale=0.7,core] (shiftsource) {}
                  node[anchor=east] at (shiftsource.west) {$\SI{30}{\mega\hertz}$}
                  node[anchor=west] at (shiftsource.east) {lo3}
                  node[below=of mul.center,fill=white] (gamma) {$\Gamma_{L,set}$};

            { [on background layer,every path/.style={dotted,decorate,decoration=random steps,segment length=2mm,thick}]
                \draw ($(adc.east)!.5!(mul.west) + (0,4)$) -- ++(0,-8.5) node[coordinate] (rightsplit) {};
            }
            { [-latex,thick]
                \draw [double,core] (shiftsource) -- (shift);
                \draw [outbuf,double] (gamma) -- (mul);
            }
            { [start chain,every on chain/.style={join=by -latex,thick}]
                \chainin (adc);
                { [every on chain/.style={join=by {inbuf,-latex,thick}}]
                    \chainin (inbuf);
                }
                \chainin (shift);
                { [every on chain/.style={join=by {double,-latex,thick}}]
                    { [every on chain/.style={join=by {double,core,-latex,thick}}]
                        \chainin (H);
                    }
                    \chainin (outbuf);
                    { [every on chain/.style={join=by {double,outbuf,-latex,thick}}]
                        \chainin (mul);
                        \chainin (dac);
                    }
                }
            }

            {[densely dashdotdotted,latex-latex,pc]
                \draw ($(inbuf.north) + (0,1)$) -- ++(0,1) node [anchor=south] {PC};
            }
        \end{tikzpicture}
        }
        \column{1cm}
        \column{5.5cm}
            \resizebox{\linewidth}{!}{
            \tikzset{external/export next=false}
            \begin{tikzpicture}
                \tikzset{module/.style={fill=Pastel1-8-1}}
                \tikzset{interface/.style={fill=Pastel1-8-2}}
                \tikzset{cpu/.style={fill=Pastel1-8-3}}
                \tikzset{kernel/.style={fill=Pastel1-8-4}}
                \tikzset{software/.style={fill=Pastel1-8-5}}
                \tikzset{digital/.style={fill=Pastel1-8-6}}
                \tikzset{pc/.style={fill=Pastel1-8-7}}
                \tikzset{os/.style={fill=Pastel1-8-8}}

                \node[anchor=base west,inner xsep=.5em] at (0,0) (digital) {Digital Part};
                \node[anchor=base west,inner xsep=.5em] at (digital.base east) (interface) {Interface};
                \node[anchor=base west,inner xsep=.5em] at (interface.base east) (cpu) {Processor};

                \draw (digital.south west) rectangle (cpu.north east);

                \node [anchor=south] at (interface.north) (module) {\parbox[t]{1.5cm}{\centering Kernel Module}};
                \node [anchor=south west] at (module.north east) (kernel) {Kernel};

                \draw (interface.north west) -- (interface.west |- kernel.north) node[coordinate] (nw) {} -- (cpu.east |- kernel.north) node[coordinate] (ne) {} -- (cpu.north east);
                \draw (interface.west |- module.north) -| (interface.north east);

                \node [anchor=south] at ($(nw)!.5!(ne)$) (software) {Daemon};

                \draw (nw) -- (nw |- software.north) -| (ne);

                \draw ($(cpu.east |- digital.south) + (2cm,0)$) node[coordinate] (pcw) {} let \p1 = ($(ne |- software.north) - (interface.west |- digital.south)$) in rectangle ++(3.5cm,\y1) node[coordinate] (pce) {};

                \node[coordinate] at ($(pcw)!.5!(pce)$) (pcs) {};

                \node at (cpu.east -| pcs) (pc) {PC};
                \node at (software.east -| pcs) (matlab) {Matlab};
                \node at ($(pc)!.5!(matlab)$) {OS};

                \draw (cpu.north -| pcw) -- (\currentcoordinate -| pce);
                \draw (ne -| pcw) -- (\currentcoordinate -| pce);

                \begin{scope}[on background layer]
                    \foreach \what in {digital,interface,cpu}
                    {
                        \fill[\what] (\what.west |- digital.south) rectangle (\what.east |- cpu.north);
                    }
                    \fill[kernel] (interface.north west) rectangle (cpu.east |- kernel.north);
                    \fill[module] (interface.north west) rectangle (interface.east |- module.north);
                    \fill[software] (nw) rectangle (ne |- software.north);
                    \fill[pc] (pcw) rectangle (pce |- cpu.north);
                    \fill[os] (pcw |- cpu.north) rectangle (pce |- ne);
                \end{scope}
                \draw[thick] (digital.east -| ne) -- ++(2cm,0);
                \draw[latex-latex] ($(digital.east)-(0.5em,0)$) -- ++(0.8em,0) -- (\currentcoordinate |- software.center);
                \draw[latex-] ($(ne |- software.center)-(0.3em,0)$) |- (digital.east -| ne);
                \draw[-latex] ($(digital.east -| ne)+(2cm,0)$) -- ++(0.3em,0) -- (\currentcoordinate |- software.center);

                \node[anchor=south,font=\small] at ($(digital.east -| ne) + (1cm,0)$) {Ethernet};

                \node[coordinate] at ($(digital.south west)-(3pt,0)$) (desc) {};

                \begin{scope}[every path/.style={decorate,decoration={brace,amplitude=3pt}}]
                    \draw (desc) -- (\currentcoordinate |- digital.north) node[midway,left,xshift=-2pt] {Hardware};
                    \draw (desc |- digital.north) -- (\currentcoordinate |- software.north) node[midway,left,xshift=-2pt] {Software};
                \end{scope}
            \end{tikzpicture}
            }
            \\\vspace{5pt}
            \resizebox{\linewidth}{!}{
            \tikzset{external/export next=false}
            \begin{tikzpicture}[every node/.style={minimum width=5em},latex-latex]
                \matrix (peripherals)[matrix of nodes,column sep=1.5em,row sep=0.2em,nodes={draw,anchor=center},ampersand replacement=\&]
                {
                    DRAM \& \shortstack{DRAM\\Controller} \\
                    |[pc]| Ethernet \& \shortstack{Ethernet\\Controller} \\
                    |[pc]| RS232 \& \shortstack{RS232\\Interface} \\
                    Storage \& Sys ACE \\
                    \shortstack{LEDs\\Switches} \& GPIO \\
                };
                \node[draw,minimum size=5em,above right=0em of peripherals] (cpu) {CPU};
                \draw (peripherals-1-1) -- (peripherals-1-2);
                \draw (peripherals-1-2) -| ([xshift=-2.5em]cpu);
                \draw ([yshift=1em]peripherals-2-2) -| ([xshift=-1.5em]cpu);
                \foreach \i in {2,...,5}
                {
                    \draw (peripherals-\i-1) -- (peripherals-\i-2);
                    \draw (peripherals-\i-2) -- (peripherals-\i-2 -| cpu);
                }
                \draw[ultra thick,-] (peripherals-5-2 -| cpu) ++(0,-1em) node[below] (plb) {PLB} -- (cpu);
                \node[draw] at ($(peripherals-5-2)!2!(peripherals-5-2 -| cpu)$) (bram) {RAM};
                \draw (peripherals-5-2 -| cpu) -- (bram);
                \node[draw] at ($(peripherals-2-2)!2!(peripherals-2-2 -| cpu)$) (pint) {\shortstack{Processor\\Interface}};
                \draw (peripherals-2-2 -| cpu) -- (pint);
                \matrix (internal)[matrix of nodes,column sep=1em,row sep=0.2em,nodes={draw,anchor=center},right=of pint]
                {
                    |[inbuf]| inbuf \\
                    |[core]| core \\
                    |[outbuf]| outbuf \\
                    auto \\
                };
                %\node[draw,right=1.5em of internal-3-1] (digiq) {Digital IQ};
                %\node[draw,right=1.5em of internal-1-1] (adc) {ADC};
                \node[coordinate,right=1 of internal-3-1] (digiq) {};
                \node[coordinate,right=1 of internal-1-1] (adc) {};
                \node[coordinate] at ($(pint.east) + (2em,0)$) (l) {};
                \foreach \i in {1,...,4}
                {
                    \draw (pint.east) -- (l) |- (internal-\i-1);
                };
                \draw[inbuf,latex-] (internal-1-1) -- (adc);
                \draw[outbuf,-latex] (internal-3-1) -- (digiq);
                \node[draw,fit=(cpu) (peripherals-5-2) (plb) (bram),inner xsep=0.5em,label=processor] (processor) {};
                \node[coordinate] at ($(processor.north) + (0,1em)$) (u) {};
                \node[draw,fit=(internal-1-1) (internal-4-1) (l),inner xsep=0.5em,label=main] (main) {};
                \node[draw,fit=(processor) (main) (u),inner xsep=0.5em,label=top] (fpga) {};

            \end{tikzpicture}
            }
            \column{2cm}
    \end{columns}
    \begin{textblock}{7}(5.7,6.9)
        \begin{itemize}
            \item Down conversion to Baseband
            \item Fully configurable filter \device{fir1}
            \item Multiplier for reflection synthesis
            \item \SI{16}{\bit} signal processing chain
        \end{itemize}
    \end{textblock}
    \note{Buffers! Lag Time!}
    \begin{textblock}{4}(0,7.25)
        \resizebox{\linewidth}{!}{
        \tikzset{external/export next=false}
        \begin{tikzpicture}
            \pgfmathsetseed{23654}
            \pgfdeclarelayer{foreground}
            \pgfsetlayers{background,main,foreground}
            \tikzpicturedependsonfile{rfsymbols.tex}
            \draw node[dut] (dut) {}
                  node[dircoupler,right=2 of dut,label=below:dir1] (dirvna) {}
                  node[oscilloscope,above=of dirvna.A2,anchor=A1] (oszivna) {}
                  node[circulator,right=of dirvna,label=below:circ1] (circ) {}

                  node[coordinate,right=of circ,yshift=1.5cm] (uppernode) {}
                  node[coordinate,right=of circ,yshift=-1.5cm] (lowernode) {}

                  (lowernode) node[amplifier,label=above:amp1] (amp) {}
                  node[mixer,right=of amp,label=above:mix3] (upmix) {}
                  node[lowpass,right=of upmix,label=above:lp1] (antialias) {}
                  node[adc,right=of antialias,label=above:dac1] (dac) {}

                  (uppernode -| upmix) node[mixer,label=below:mix1] (downmix) {}
                  node[bandpass,right=of downmix,label=below:bp1] (bp) {}
                  node[adc,right=of bp,label=below:adc1] (adc) {}
                  node[empty,right=of adc,label=below:buffer1] (inbuf) {}
                  node[mixer,right=of inbuf] (shift) {}
                  node[anchor=west] at (shift.east) {mix2}

                  (dac -| inbuf) node[mixer,label=above:mul1,generate] (mul) {}
                  node[empty,right=of mul] (outbuf) {}
                  node[anchor=north] at (outbuf.south) {buffer2}

                  ($(shift)!.5!(outbuf)$) node[allpass,generate] (H) {}
                  node[anchor=west] at (H.east) {fir1}

                  node[source,above=of downmix.center,scale=0.7] (downsource) {}
                  node[anchor=west] at (downsource.east) {lo1}
                  node[source,above=of adc.center,scale=0.7] (sample) {}
                  node[anchor=west] at (sample.east) {lo2}
                  node[source,above=of shift.center,scale=0.7] (shiftsource) {}
                  node[anchor=west] at (shiftsource.east) {lo3}
                  node[source,below=of upmix.center,scale=0.7] (upsource) {}
                  node[anchor=west] at (upsource.east) {lo4}
                  node[below=of mul.center] (gamma) {$\Gamma_{L,set}$};

            \draw ($(dut)!.5!(dirvna)$) node[coordinate] (plane) {};

            { [rounded corners=2pt,thick]
                \draw (dut) -- (dirvna) -- (circ.A);
                \draw[incident] [-latex] (circ.B) -- ($(circ.B |- uppernode)!.5!(uppernode)$) node[coordinate] (upper) {} -- (downmix);
                \draw[incident] (dirvna.A2) -- (oszivna.A1);
                \draw[reflect] (dirvna.B2) |- ($(dirvna.B2)!.7!(oszivna.A2)$) node[coordinate] (oszimiddle) {} -| (oszivna.A2);
                \draw[reflect] [-latex] (amp) -- ($(circ.C |- amp)!.5!(lowernode)$) node[coordinate] (lower) {} -- (circ.C);
            }
            { [-latex,thick]
                \draw (downsource) -- (downmix);
                \draw (sample) -- (adc);
                \draw [double] (shiftsource) -- (shift);
                \draw[generate,double] (gamma) -- (mul);
                \draw (upsource) -- (upmix);
            }
            { [latex-,dashed,every node/.style={font=\footnotesize},thick]
                \foreach \device in {downsource,sample,shiftsource} {
                    \draw (\device) -- ++(0,1) node[anchor=south] {ref};
                }
                \draw ([xshift=0.5cm]oszivna.north) -- ++(0,0.5) node[fill=white,anchor=south] {ref};
                \draw (upsource) -- ++(0,-1) node[anchor=north] {ref};
            }
            { [start chain,every on chain/.style={join=by {-latex,incident,thick}}]
                \chainin (downmix);
                \chainin (bp);
                \chainin (adc);
                \chainin (inbuf);
                \chainin (shift);
                { [every on chain/.style={join=by {double,-latex,incident,thick}}]
                    \chainin (H);
                    \chainin (outbuf);
                    \chainin (mul);
                }
            }
            { [start chain,every on chain/.style={join=by {-latex,reflect,thick}}]
                { [every on chain/.style={join=by {double,-latex,reflect,thick}}]
                    \chainin (mul);
                    \chainin (dac);
                    \chainin (antialias);
                    \chainin (upmix);
                }
                \chainin (amp);
            }
            { [on background layer]
                \clip ($(dirvna.B1)!.5!(circ.A) + (-1,-4.485)$) rectangle ($(adc.east)!.5!(mul.west) + (4,4.485)$);
                \draw[dotted,thick,decoration=random steps,segment length=2mm]
                    decorate { ($(dirvna.B1)!.5!(circ.A) + (0,4.5)$) -- ++(0,-9) node[coordinate] (leftsplit) {} };
                \draw[fill=red!10,dotted,thick,decoration=random steps,segment length=2mm]
                    ($(adc.east)!.5!(mul.west) + (0,-4.5)$) node[coordinate] (rightsplit) {}
                        decorate { -- ++(0,9) } -| ++(5,-9) -- cycle;
            }

            \draw (leftsplit) node[anchor=base east] {One Port VNA}
                  (leftsplit) node[anchor=base west] {Analog}
                  (rightsplit) node[anchor=base west] {Digital}
                  (rightsplit) node[anchor=base east] {Analog};

            \draw [dashed] ($(plane) + (0,4)$) node[anchor=south] {Load Reference Plane} -- ($(plane) - (0,4.5)$);

            \draw [latex-] ($(plane) + (0,1.5)$) -- ++(-0.5,0) node[anchor=east] {$Z_L$};

            \draw [-latex,reflect] ($(plane) + (0.25,-1.5)$) node[anchor=west] {$a_2$}-- ++(-0.5,0);
            \draw [latex-,incident] ($(plane) + (0.25,-2)$) node[anchor=west] {$b_2$}-- ++(-0.5,0);
            \draw [latex-] ($(plane) + (0,-2.5)$) -- ++(-0.5,0) node[anchor=east] {$\Gamma_L$};

            {[densely dashdotdotted,latex-latex,thick]
                \draw ($(inbuf.north) + (0,1)$) -- ++(0,1) node [anchor=south] {PC};
                \draw ([xshift=-0.5cm]oszivna.north) -- ++(0,1) node [anchor=south] {PC};
            }
        \end{tikzpicture}
        }
    \end{textblock}
\end{frame}

\section{Results}

\begin{frame}{Calibrated Filter, Uncalibrated $\Gamma_{L,set}$}
    \note{Uncalibrated $\Gamma_{L,set}$ (reflections from rest of setup!)}
    \note{\par Mean also possible}
    \begin{columns}
        \column{0.5\linewidth}
            \begin{tikzpicture}[every axis/.style={font=\tiny}]
                \begin{smithchart}[width=\linewidth,clip=false,title={\normalsize $0.5 \angle \SI{135}{\degree}$}]
                    \foreach \i in {1,...,11}{
                        \foreach \j in {1,...,11}{
                            \addplot[blue,is smithchart cs,line join=bevel] file {testdata/filter/0.5,135/\i,\j.data};
                        }
                    }
                    \addplot[red,is smithchart cs,mark=*,only marks] coordinates {(-0.3536,0.3536)};
                \end{smithchart}
            \end{tikzpicture}
            \begin{center}
                11 by 11 grid $\Gamma_{L,set}$
            \end{center}
        \column{0.5\linewidth}
        \begin{itemize}
            \item \SI{11}{\mega\hertz} bandwidth trajectories
            \item $\Gamma_L$ constant near calibration point
        \end{itemize}
    \end{columns}
\end{frame}

\section*{Summary}

\begin{frame}[t]{Summary}
    \begin{exampleblock}{Active Load-Pull measurement system}
        \begin{itemize}
            \item Constant $\Gamma_L$ over \SI{20}{\mega\hertz} bandwidth
        \end{itemize}
    \end{exampleblock}
    \begin{columns}
        \column{.47\textwidth}
            \begin{block}{Components}
                \begin{itemize}
                    \item One port VNA
                    \item Analog part
                    \item Digital part
                \end{itemize}
            \end{block}
        \column{.47\textwidth}
            \begin{block}{Digital part (FPGA)}
                \begin{itemize}
                    \item Signal processing chain
                    \item Embedded processor design
                    \item Linux kernel module
                    \item Controllable via Ethernet
                \end{itemize}
            \end{block}
    \end{columns}

    \begin{columns}
        \column{.47\textwidth}
            \begin{block}{Algorithms in Matlab}
                \begin{itemize}
                    \item Filter calibration
                    \item Target algorithm
                    \item Verification measurements
                \end{itemize}
            \end{block}
        \column{.47\textwidth}
    \end{columns}

    \begin{textblock}{5.5}(6.8,6.65)
        {\setlength{\fboxsep}{0pt}\setlength{\fboxrule}{0.2pt}\fbox{\includegraphics[width=\textwidth]{webinterface}}}
    \end{textblock}
\end{frame}

% =============================================================================

\appendix
\backupbegin
\section<presentation>*{\appendixname}

\begin{frame}
    \begin{columns}
        \note{$a$ $b$: DFT}
        \column{5cm}
            \tikzset{external/export next=false}
            \begin{tikzpicture}
                \pgfmathsetseed{23654}
                \pgfdeclarelayer{foreground}
                \pgfsetlayers{background,main,foreground}
                \tikzpicturedependsonfile{rfsymbols.tex}
                \tikzstyle{every node}=[font=\footnotesize]
                \draw node[dut] (dut) {}
                      node[dircoupler,right=2 of dut,label=below:dir1] (dirvna) {}
                      node[oscilloscope,above=of dirvna.A2,anchor=A1] (oszivna) {}
                      node[coordinate,right=1.5em of dirvna] (rest) {}
                      node[coordinate,right=1.5em of rest] (resta) {};

                \draw ($(dut)!.5!(dirvna)$) node[coordinate] (plane) {};

                \draw [dashed] (rest) -- (resta);

                { [rounded corners=2pt]
                    \draw (dut) -- (dirvna) -- (rest);
                    \draw[incident] (dirvna.A2) -- (oszivna.A1);
                    \draw[reflect] (dirvna.B2) |- ($(dirvna.B2)!.7!(oszivna.A2)$) node[coordinate] (oszimiddle) {} -| (oszivna.A2);
                }
                { [latex-,dashed,every node/.style={font=\footnotesize}]
                    \draw ([xshift=0.5cm]oszivna.north) -- ++(0,0.5) node[fill=white,anchor=south] {ref};
                }
                { [on background layer,every path/.style={dotted,decorate,decoration=random steps,segment length=2mm,thick}]
                    \draw ($(rest) + (0,4)$) -- ++(0,-7) node[coordinate] (leftsplit) {};
                }

                \draw (leftsplit) node[anchor=base east] {One Port VNA}
                      (leftsplit) node[anchor=base west] {Analog};

                \draw [-latex,incident] ($(dirvna.A2) + (-0.2,0.1)$) -- node[base left] {$b'_2$} ($(oszivna.A1 |- oszimiddle) - (0.2,0.1)$);
                \begin{pgfonlayer}{foreground}
                    \draw [-latex,reflect] ($(dirvna.B2) + (0.2,0.1)$) -- node[coordinate] (a1) {} ($(oszimiddle -| dirvna.B2) + (0.2,-0.1)$);
                \end{pgfonlayer}
                \draw (a1) node[base right,reflect] {$a'_2$};

                \draw [dashed] ($(plane) + (0,4)$) node[anchor=south] {Load Reference Plane} -- ($(plane) - (0,3)$);

                \draw [latex-] ($(plane) + (0,1.5)$) -- ++(-0.5,0) node[anchor=east] {$Z_L$};

                \draw [-latex,reflect] ($(plane) + (0.25,-1.5)$) node[anchor=west] {$a_2$}-- ++(-0.5,0);
                \draw [latex-,incident] ($(plane) + (0.25,-2)$) node[anchor=west] {$b_2$}-- ++(-0.5,0);
                \draw [latex-] ($(plane) + (0,-2.5)$) -- ++(-0.5,0) node[anchor=east] {$\Gamma_L$};

                {[densely dashdotdotted,latex-latex]
                    \draw ([xshift=-0.5cm]oszivna.north) -- ++(0,1) node [anchor=south] {PC};
                }
            \end{tikzpicture}
        \column{5cm}
            \begin{enumerate}
                \item Acquire \textcolor{incident}{$a_1$}, \textcolor{reflect}{$b_1$}
                \item Extract phase and magnitude
                \tikzset{external/export next=false}
                \item $\Gamma_L = \frac{\textcolor{reflect}{a_2}}{\textcolor{incident}{b_2}} \tikz[remember picture,baseline] \node[anchor=base] (approx) {$\approx$}; \frac{\textcolor{reflect}{a'_2}}{\textcolor{incident}{b'_2}}$
                    \tikzset{external/export next=false}
                    \tikz[overlay,remember picture] \draw [latex-] (approx.south) -- ++(0,-2em) node[below] {Systematic Errors};
            \end{enumerate}
    \end{columns}
\end{frame}

\begin{frame}{Errorbox One Port VNA}
    \begin{columns}
        \column{5cm}
            \begin{tikzpicture}
                \matrix (box)
                [matrix of nodes,%
                 nodes in empty cells,
                 nodes={dspnodeopen},
                 column sep=0.5cm,
                 row sep=2cm,
                 ampersand replacement=\&]
                {
                    |[coordinate]| \& \&[3cm] \& \&[.5cm] |[coordinate]| \\
                    |[coordinate]| \& \& \& \& |[coordinate]| \\
                };
                \draw[-latex] (box-1-1) node[anchor=east] {$a_{1}$} -- (box-1-2);
                \draw[-latex] (box-1-2) -- node[above] {$1$} (box-1-3);
                \draw[-latex] (box-1-3) -- node[above] {$b_{2}$} (box-1-4);

                \draw[latex-] (box-2-1) node[anchor=east] {$b_{1}$} -- (box-2-2);
                \draw[latex-] (box-2-2) -- node[above] {$S_{12}$} (box-2-3);
                \draw[latex-] (box-2-3) -- node[above] {$a_{2}$} (box-2-4);

                \draw[-latex] (box-1-2) to[bend left=30] node[right] {$S_{11}$} (box-2-2);
                \draw[latex-] (box-1-3) to[bend right=30] node[left] {$S_{22}$} (box-2-3);

                \draw[-latex] (box-1-4) to[bend left=30] node[right] {$\Gamma_L$} (box-2-4);

                \draw ($(box-1-2) + (0,0.7cm)$) rectangle ($(box-2-3) - (0,0.7cm)$);
                \draw ($(box-1-4) + (0,0.7cm)$) rectangle ($(box-2-5) - (0,0.7cm)$);

                \draw[dashed] (box-1-2) -- ++(0,1.5cm) node[anchor=south] {Oscilloscope};
                \draw[dashed] (box-1-3) -- ++(0,1.5cm) node[anchor=south] {Load Reference Plane};

                \draw[dashed] (box-2-2) -- ++(0,-1cm);
                \draw[dashed] (box-2-3) -- ++(0,-1cm);

                \draw ($(box-2-4)!.5!(box-2-5) - (0,0.7cm)$) node[anchor=north] {DUT};
                \draw ($(box-2-2)!.5!(box-2-3) - (0,0.7cm)$) node[anchor=north] {Error box};
            \end{tikzpicture}
        \column{5cm}
            \begin{description}
                \item[$S_{11}$] Directivity
                \note[item]{Directivity: Reflections not from DUT}
                \item[$S_{12}$] Reflection tracking
                \note[item]{Reflection Tracking: Frequency response oscilloscope ports; coupler loss; transmission lines}
                \item[$S_{22}$] Source match
                \note[item]{Source match: Mismatch DUT/Measurement system}
            \end{description}
    \end{columns}
\end{frame}

\begin{frame}{Iterative Target Algorithm}
    \begin{enumerate}
        \item Arbitrary start point
        \item Measure $\Gamma_L$
        \item If $\abs{\Gamma_L - \Gamma_{L,target}} < accuracy$ \Rightarrow done
        \item Scale $\Gamma_{L,set}$ according to $\frac{\Gamma_{L,target}}{\Gamma_L}$
        \item Pause to compensate for lag time
        \item Repeat from step 2
    \end{enumerate}
\end{frame}

\begin{frame}{Iterative Target Algorithm}
    \resizebox{\linewidth}{!}{
    \begin{tikzpicture}
        \begin{scope}[shift={(0,4.5)}]
            \foreach \x in {0,...,11}
            {
                \begin{scope}[shift={($\x*(0.8,0)-(5,0)$)}]
                    \fill [YlOrRd-3-1] (0,0)   |- (0.2,1) node[coordinate] (acquire-n-\x) {} -- (0.2,0) node[coordinate] (acquire-s-\x) {} -- cycle;
                    \fill [YlOrRd-3-2] (0.2,0) |- (0.6,1) node[coordinate] (filter-n-\x) {} -- (0.6,0) node[coordinate] (filter-s-\x) {} -- cycle;
                    \fill [YlOrRd-3-3] (0.6,0) |- (0.8,1) node[coordinate] (switch-n-\x) {}  -- (0.8,0) node[coordinate] (switch-s-\x)  {} -- cycle;
                \end{scope}
            }
            \draw [-latex] (-5,0) --  (5,0) node[anchor=west,font=\tiny] {time};
            \draw (-5,0.5) node[anchor=east,font={}] (phase) {FPGA Phase};
        \end{scope}
            \begin{scope}
                \clip (-5,-1) rectangle (4.6,2);
                \node[coordinate] at (-4.7,0) (measure-start) {};
                \foreach \x in {0,1}
                {
                    \begin{scope}[shift={($\x*(5.7,0)-(4.7,0)$)}]
                        \fill[Set2-4-1] (0,0)   |- (1.4,1) node[coordinate] (measure-n-\x) {} -- (1.4,0) node[coordinate] (measure-s-\x) {} -- cycle;
                        \fill[Set2-4-2] (1.4,0) |- (1.5,1) node[coordinate] (compute-n-\x) {} -- (1.5,0) node[coordinate] (compute-s-\x) {} -- cycle;
                        \fill[Set2-4-3] (1.5,0) |- (1.6,1) node[coordinate] (set-n-\x) {}     -- (1.6,0) node[coordinate] (set-s-\x) {}     -- cycle;
                        \fill[Set2-4-4] (1.6,0) |- (5.7,1) node[coordinate] (pause-n-\x) {}   -- (5.7,0) node[coordinate] (pause-s-\x) {}   -- cycle;
                    \end{scope}
                }
                \fill[yellow!33] (-5,0) rectangle (-4.7,1);
            \end{scope}

            \draw [-latex] (-5,0) --  (5,0) node[anchor=west,font=\tiny] {time};
            \draw (-5,0.5) node[anchor=east,font={}] (target) {Algorithm Phase};
        \begin{scope}[shift={(0,3)}]
            \draw (-5,0.5) node[anchor=east,font={}] (b2) {$b_2$};
            \fill[green] (-5,0) rectangle ($(set-n-0 |- 0,1)+(0.2,0)$) node[coordinate] (b-n-1) {};
            \fill[red!33] (b-n-1 |- 0,0) node[coordinate] (b-s-1) {} rectangle ($(switch-s-3 |- 0,1)+(0.1,0)$) node[coordinate] (b-n-2) {};
            \fill[red!66] (b-n-2 |- 0,0) node[coordinate] (b-s-2) {} rectangle ($(switch-s-5 |- 0,1)+(0.1,0)$) node[coordinate] (b-n-3) {};
            \fill[red]    (b-n-3 |- 0,0) node[coordinate] (b-s-3) {} rectangle ($(set-n-1 |- 0,1)+(0.2,0)$) node[coordinate] (b-n-4) {};
            \fill[blue!33](b-n-4 |- 0,0) node[coordinate] (b-s-4) {} rectangle ($(switch-s-10 |- 0,1)+(0.1,0)$) node[coordinate] (b-n-5) {};
            \fill[blue!66](b-n-5 |- 0,0) node[coordinate] (b-s-5) {} rectangle (4.6,1);
            \draw [-latex] (-5,0) --  (5,0) node[anchor=west,font=\tiny] {time};
        \end{scope}
        \begin{scope}[shift={(0,1.5)}]
            \draw (-5,0.5) node[anchor=east,font={}] (a2) {$a_2$};
            \fill[green] (-5,0) rectangle ($(set-n-0 |- 0,1)+(0.1,0)$) node[coordinate] (a-n-1) {};
            \fill[red!33] (a-n-1 |- 0,0) node[coordinate] (a-s-1) {} rectangle (switch-s-3 |- 0,1) node[coordinate] (a-n-2) {};
            \fill[red!66] (a-n-2 |- 0,0) node[coordinate] (a-s-2) {} rectangle (switch-s-5 |- 0,1) node[coordinate] (a-n-3) {};
            \fill[red]    (a-n-3 |- 0,0) node[coordinate] (a-s-3) {} rectangle ($(set-n-1 |- 0,1)+(0.1,0)$) node[coordinate] (a-n-4) {};
            \fill[blue!33](a-n-4 |- 0,0) node[coordinate] (a-s-4) {} rectangle (switch-s-10 |- 0,1) node[coordinate] (a-n-5) {};
            \fill[blue!66](a-n-5 |- 0,0) node[coordinate] (a-s-5) {} rectangle (4.6,1);
            \draw [-latex] (-5,0) --  (5,0) node[anchor=west,font=\tiny] {time};
        \end{scope}
        \begin{scope}[-latex]
            \draw (set-n-0) -- (a-s-1) node[midway,right,font=\tiny] {$\Gamma_{L,set,0}$};
            \draw (set-n-1) -- (a-s-4) node[midway,right,font=\tiny] {$\Gamma_{L,set,1}$};
            \foreach \x in {1,...,5}
            {
                \draw (a-n-\x) -- (b-s-\x);
            }
            \draw (b-n-1 -| switch-s-2) -- (switch-s-2);
            \draw (b-n-1 -| switch-s-4) -- (switch-s-4);
            \draw (b-n-1 -| switch-s-9) -- (switch-s-9);
            \draw (switch-n-3) to[bend right=10] (a-s-2);
            \draw (switch-n-5) to[bend right=10] (a-s-3);
            \draw (switch-n-10) to[bend right=10] (a-s-5);
            \draw (measure-start |- b-n-1) to[bend right=10] (measure-start);
            \draw (measure-start |- a-n-1) to[bend left=10] (measure-start);
            \draw (pause-s-0 |- b-n-1) to[bend right=10] (pause-s-0);
            \draw (pause-s-0 |- a-n-1) to[bend left=10] (pause-s-0);
        \end{scope}

        \draw ($(switch-n-2)!.5!(acquire-n-3)$) -- ++(-1,0.5) node[draw,fill=YlOrRd-3-1] {Acquire};
        \draw ($(acquire-n-3)!.5!(filter-n-3)$) -- ++(0,1.2) node[draw,fill=YlOrRd-3-2] {Filter};
        \draw ($(filter-n-3)!.5!(switch-n-3)$) -- ++(1,0.5) node[draw,fill=YlOrRd-3-3] {Switch};

        \draw ($(measure-start)!.5!(measure-s-0)$) -- ++(-1,-0.5) node[draw,fill=Set2-4-1] {Measure $\Gamma_L$};
        \draw ($(measure-s-0)!.5!(compute-s-0)$) -- ++(-.7,-1.5) node[draw,fill=Set2-4-2] {Calculate new $\Gamma_{L,set}$};
        \draw ($(compute-s-0)!.5!(set-s-0)$) -- ++(3,-1.5) node[draw,fill=Set2-4-3] {Set new $\Gamma_{L,set}$};
        \draw ($(set-s-0)!.5!(pause-s-0)$) -- ++(1,-0.5) node[draw,fill=Set2-4-4] {Pause};
    \end{tikzpicture}
    }
\end{frame}

\begin{frame}[fragile]{Target algorithm 1}
    \note{Good}
    \begin{columns}
        \column{9cm}
            \tikzset{external/export next=false}
            \begin{tikzpicture}[
                spy/.style={%
                    draw,green,
                    line width=0.5pt,
                    circle,inner sep=0pt,
                },
                every axis/.style={font=\footnotesize},
                ]
                \def\spyviewersize{3cm}
                \def\spyonclipreduce{0.5pt}
                \def\spyfactorI{10}

                \def\pic#1#2{
                    \begin{smithchart}[width=7cm,clip=false#1]
                        \addplot[blue,is smithchart cs,line join=bevel] file {testdata/filter/1.0,0/trajectory10.data};
                        \addplot[purple,is smithchart cs,only marks,mark=x#2] file {testdata/filter/1.0,0/trajectory10.data};
                        \draw (cartesian cs:1,0) node[coordinate] (a) {}
                              (cartesian cs:-0.4,0.4) node[coordinate] (b) {};
                    \end{smithchart}
                }
                \pic{}{}
                \coordinate (spy-on 1) at (a);
                \coordinate (spy-in 1) at (b);

                \node[spy,ultra thick,circular drop shadow,minimum size=\spyviewersize,fill=white,label={[inner sep=2pt,yshift=-5pt,fill=white,font=\small]below:\spyfactorI{}x magnification}] (spy-in node 1) at (spy-in 1) {};
                \begin{scope}
                    \clip (spy-in 1) circle (0.5*\spyviewersize-\spyonclipreduce);
                    \pgfmathsetmacro\sI{1/\spyfactorI}
                    \begin{scope}[
                        shift={($\sI*(spy-in 1)-\sI*(spy-on 1)$)},
                        scale around={\spyfactorI:(spy-on 1)}
                    ]
                    \pic{,every axis plot post/.append style={line width=0.07pt},every axis/.append style={line width=0.07pt,grid style={line width=0.07pt}}}{,mark size=0.35pt}
                    \end{scope}
                \end{scope}

            \end{tikzpicture}
        \column{4cm}
            $\Gamma_{L,target} = 1$
    \end{columns}
\end{frame}

\begin{frame}{Target algorithm performance}
    \begin{columns}
        \column{7cm}
            \begin{tikzpicture}
                \begin{axis}[
                        title = 108 algorithm invocations,
                        ybar interval,
                        ylabel={percentage of invocations},
                        xlabel={number of iterations},
                        x filter/.expression={x-1}, % remove the start point
                        width=7cm,
                        ymin = 0
                    ]
                    \addplot[blue,fill=blue!10,hist={bins=7,data min=3,data max=10,density=true}] table[y index=0] {testdata/trajectories/performance.data};
                \end{axis}
            \end{tikzpicture}
        \column{5cm}
            \begin{block}{Performance dependent on}
                \begin{itemize}
                    \item Start point
                    \item Target
                    \item Resolution in target area
                    \item Pause for lag time compensation
                \end{itemize}
            \end{block}
    \end{columns}
\end{frame}

        \def\bpspec#1#2{%
            \begin{scope}[shift={#1}]
                \draw [#2] (-0.2,0) -- (-0.2,0.5) -- (0.2,0.8) -- (0.2,0);
            \end{scope}
        }

\begin{frame}{Down Conversion Spectra}
    \resizebox{\linewidth}{!}{
    \begin{tikzpicture}[every node/.style={font=\small},every path/.style={decoration={name=zigzag,segment length=2pt}}]
        \begin{scope}[shift={(0,6)}]
            \draw [latex-latex] (-5,0) -- (3,0) decorate { -- (3.1,0) } -- (5,0) node[anchor= west] {frequency};
            \draw [-latex] (0,-0.2) -- (0,1) node[anchor=south] {amplitude};
            \bpspec{(3.5,0)}{solid,thick}
            \draw (3.5,0.1) -- (3.5,-0.1) node[anchor=north] {$f_0$};
            \draw (-5,0.5) node[anchor=east,font={}] (rf) {RF};
            \draw [-latex] (3.5,0) to[bend left=30] ($0.7*(2,0)$);
            \draw ($0.7*(2,0) + (0,0.1)$) -- ($0.7*(2,0) - (0,0.1)$) node[anchor=north] {$\SI{70}{\mega\hertz}$};
        \end{scope}
        \begin{scope}[shift={(0,4)}]
            \draw [latex-latex] (-5,0) -- (4,0) decorate { -- (4.1,0) } -- (5,0) node[anchor=west] {frequency};
            \draw [-latex] (0,-0.2) -- (0,1);
            \bpspec{(4.5,0)}{dashed}
            \draw (4.5,0.1) -- (4.5,-0.1) node[anchor=north] {$2f_0 + \SI{70}{\mega\hertz}$};
            \bpspec{($0.7*(2,0)$)}{solid,thick}
            \draw ($0.7*(2,0) + (0,0.1)$) -- ($0.7*(2,0) - (0,0.1)$) node[anchor=north] {$\SI{70}{\mega\hertz}$};
            \draw (-5,0.5) node[anchor=east,font={}] (if) {IF};
            \draw [dashed,very thick,-latex] (0,0) -- (0,0.8);
        \end{scope}
        \begin{scope}[shift={(0,2)}]
            \draw [latex-latex] (-5,0) -- (5,0) node[anchor=west] {frequency};
            \draw [-latex] (0,-0.2) -- (0,1);
            \foreach \x in {-2,-1,1,2} {
                \draw ($\x*(2,0) + (0,0.1)$) -- ($\x*(2,0) - (0,0.1)$) node[anchor=north] {$\x f_s$};
                \draw [dotted] ($\x*(2,0)$) -- ($\x*(2,0) + (0,1)$);
                \draw [thick,-latex,dashed] ($\x*(2,0)$) -- ($\x*(2,0) + (0,0.8)$);
            }
            \foreach \x in {-3,-2,0,1} {
                \bpspec{($0.7*(2,0) + \x*(2,0)$)}{dashed}
            }
            \begin{scope}[xscale=-1]
                \foreach \x in {-3,...,1} {
                    \bpspec{($0.7*(2,0) + \x*(2,0)$)}{dashed}
                }
            \end{scope}
            \bpspec{($0.7*(2,0) + -1*(2,0)$)}{solid,thick}
            \draw [-latex] ($0.7*(2,0) - (2,0)$) to[bend right=45] (0,0);
            \draw ($0.7*(2,0) + -1*(2,0) + (0,0.1)$) -- ($0.7*(2,0) + -1*(2,0) + (0,-0.1)$) node[anchor=north] {$\SI{-30}{\mega\hertz}$};
            \draw (-5,0.5) node[anchor=east,font={}] (sample) {sampling};
            \draw [very thick,-latex,dashed] (0,0) -- (0,0.8);
        \end{scope}
        \draw [latex-latex] (-5,0) -- (5,0) node[anchor=west] {frequency};
        \draw [-latex] (0,-0.2) -- (0,1);
        \foreach \x in {-2,-1,1,2} {
            \draw ($\x*(2,0) + (0,0.1)$) -- ($\x*(2,0) - (0,0.1)$) node[anchor=north] {$\x f_s$};
            \draw [dotted] ($\x*(2,0)$) -- ($\x*(2,0) + (0,1)$);
        }
        \bpspec{(0,0)}{solid,thick}
        \draw (-5,0.5) node[anchor=east,font={}] (mix) {digital mixer};
        \draw [-latex] ([xshift=-5pt]rf.south east) -- ([xshift=-5pt]if.north east);
        \draw [-latex] ([xshift=-5pt]if.south east) -- ([xshift=-5pt]sample.north east);
        \draw [-latex] ([xshift=-5pt]sample.south east) -- ([xshift=-5pt]mix.north east);
        \foreach \x in {-3,-2,0,1} {
            \bpspec{($(2,0) + \x*(2,0)$)}{dashed}
        }
        \begin{scope}[xscale=-1]
            \foreach \x in {-2,...,2} {
                \bpspec{($0.4*(2,0) + \x*(2,0)$)}{dashed}
            }
        \end{scope}
        \foreach \x in {-2,...,2} {
            \draw [thick,-latex,dashed] ($\x*(2,0) + 0.3*(2,0)$) -- ($\x*(2,0) + 0.3*(2,0) + (0,0.8)$);
        }
    \end{tikzpicture}
    }
\end{frame}

\begin{frame}{Overlap Add Algorithm}
\begin{figure}[htb]
    \centering
    \begin{tikzpicture}
        \begin{scope}[shift={(0,13em)}]
            \draw [decorate,decoration={brace},yshift=2pt] (0,4.1em) -- (5,4.1em) node[midway,yshift=8pt] {$n$};
            \draw [decorate,decoration={brace},yshift=2pt] (0,2.8em) -- (3,2.8em) node[midway,yshift=8pt] {$n_{fft}$};
            \draw [decorate,decoration={brace},yshift=2pt] (0,1.5em) -- (2,1.5em) node[midway,yshift=8pt] {$L$};
            \draw (0,0.75em) node[anchor=east] {$x[n]$};
            \draw (0,0) rectangle (5,1.5em);
            \draw (5,0.75em) node[anchor=west] (zeros) {0000};
            \draw [dashed] (5,0) rectangle (6,1.5em) (2,0) -- (2,1.5em) (4,0) -- (4,1.5em);
        \end{scope}
        \begin{scope}[shift={(0,9em)}]
            \draw (0,0.75em) node[anchor=east] {$y_0[n]$};
            \draw (0,0) rectangle (2,1.5em);
            \draw [fill=black!30] (2,0) rectangle (3,1.5em);
            \draw (2.5,0) node[coordinate] (y0b) {};
            \draw (0.5,0) node[coordinate] (y2b) {};
        \end{scope}
        \begin{scope}[shift={(0,6em)}]
            \draw (0,0.75em) node[anchor=east] {$y_1[n]$};
            \draw (2,0) rectangle (4,1.5em);
            \draw [fill=black!30] (4,0) rectangle (5,1.5em);
            \draw (2.5,1.5em) node[coordinate] (y1t) {};
            \draw (4.5,0) node[coordinate] (y1b) {};
        \end{scope}
        \begin{scope}[shift={(0,3em)}]
            \draw (0,0.75em) node[anchor=east] {$y_2[n]$};
            \draw (4,0) rectangle (6,1.5em);
            \draw [fill=black!30] (6,0) rectangle (7,1.5em);
            \draw [fill=red!30] (0,0) rectangle (1,1.5em);
            \draw (1,0.75em) node[coordinate] (circto) {};
            \draw (4.5,1.5em) node[coordinate] (y2t) {};
            \draw (0.5,1.5em) node[coordinate] (ynt) {};
        \end{scope}
        \draw (0,0.75em) node[anchor=east] {$y[n]$};
        \draw (0,0) rectangle (5,1.5em);
        \draw [dashed,color=red] (5,0) rectangle (6,1.5em);
        \draw [dotted] (6,1.5em) rectangle (7,0em);
        \draw [latex-,color=red] (circto) parabola (5.5,1.5em);

        \draw ($(y0b)!.5!(y1t)$) node {$+$};
        \draw ($(y1b)!.5!(y2t)$) node {$+$};
        \draw ($(y2b)!.5!(ynt)$) node {$+$};
        \draw [dotted]
              (0,1.5em) -- (0,13em)
              (1,1.5em) -- (1,9em)
              (2,1.5em) -- (2,9em)
              (3,7.5em) -- (3,9em)
              (3,1.5em) -- (3,6em)
              (4,1.5em) -- (4,6em)
              (5,1.5em) -- (5,3em)
              (5,4.5em) -- (5,6em)
              (7,1.5em) -- (7,3em)
              (2,13em) -- (3,10.5em)
              (4,13em) -- (5,10.5em) -- (5,7.5em)
              (6,13em) -- (7,10.5em) -- (7,4.5em);
    \end{tikzpicture}
\end{figure}
\end{frame}

\begin{frame}{FPGA Design}
    \resizebox{\linewidth}{!}{
    \begin{tikzpicture}[every node/.style={minimum width=5em},latex-latex]
        \matrix (peripherals)[matrix of nodes,column sep=1em,row sep=0.2em,nodes={draw,anchor=center},ampersand replacement=\&]
        {
            DRAM \& \shortstack{DRAM\\Controller} \\
            Ethernet \& \shortstack{Ethernet\\Controller} \\
            RS232 \& \shortstack{RS232\\Interface} \\
            Storage \& SysAce \\
            \shortstack{LEDS\\Switches} \& GPIO \\
        };
        \node[draw,minimum size=5em,above right=0em of peripherals] (cpu) {CPU};
        \draw (peripherals-1-1) -- (peripherals-1-2);
        \draw (peripherals-1-2) -| ([xshift=-2.5em]cpu);
        \draw ([yshift=1em]peripherals-2-2) -| ([xshift=-1.5em]cpu);
        \foreach \i in {2,...,5}
        {
            \draw (peripherals-\i-1) -- (peripherals-\i-2);
            \draw (peripherals-\i-2) -- (peripherals-\i-2 -| cpu);
        }
        \draw[ultra thick,-] (peripherals-5-2 -| cpu) ++(0,-1em) node[below] (plb) {PLB} -- (cpu);
        \node[draw] at ($(peripherals-5-2)!2!(peripherals-5-2 -| cpu)$) (bram) {RAM};
        \draw (peripherals-5-2 -| cpu) -- (bram);
        \node[draw] at ($(peripherals-2-2)!2!(peripherals-2-2 -| cpu)$) (pint) {\shortstack{Processor\\Interface}};
        \draw (peripherals-2-2 -| cpu) -- (pint);
        \matrix (internal)[matrix of nodes,column sep=1em,row sep=0.2em,nodes={draw,anchor=center},right=of pint]
        {
            inbuf \\
            core \\
            outbuf \\
            auto \\
        };
        \node[draw,right=1.5em of internal-3-1] (digiq) {Digital I/Q};
        \node[draw,right=1.5em of internal-1-1] (adc) {ADC};
        \node[coordinate] at ($(pint.east) + (2em,0)$) (l) {};
        \foreach \i in {1,...,4}
        {
            \draw (pint.east) -- (l) |- (internal-\i-1);
        };
        \draw (internal-1-1) -- (adc);
        \draw (internal-3-1) -- (digiq);
        \node[draw,fit=(internal-1-1) (internal-4-1) (l),inner xsep=0.5em,label=main] (main) {};
        \node[draw,fit=(cpu) (peripherals-5-2) (plb) (main),inner xsep=0.5em,label=top] (fpga) {};

    \end{tikzpicture}
    }
\end{frame}

\begin{frame}{Signal Processing Chain}
    \begin{columns}
        \column{.5\linewidth}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}
                \foreach \i/\j in {0/2pt,1/0pt}
                {
                    \begin{scope}[xshift=\j,yshift=\j,every node/.style={draw,fill=white}]
                        \node (gtx\i) {GTX};
                        \node[left=2em of gtx\i] (descramble\i) {descramble};
                        \node[below=1em of gtx\i] (align\i) {align};
                        \draw[latex-latex] (align\i) -- (gtx\i);
                        \draw[-latex] (gtx\i) -- (descramble\i);
                        \draw[latex-latex] (gtx\i.east) -- ++(2.5em,0); % node[draw,anchor=west] {adc};
                    \end{scope}
                };
                \node[trapezium,rotate=90,anchor=center,draw,minimum height=1em] at ($(descramble0.west) + (-2em,-1pt)$) (mux) {};
                \draw[-latex] ([xshift=-2pt]descramble0.west) -- (mux.south |- descramble0);
                \draw[-latex] (descramble1.west) -- (mux.south |- descramble1);

                \node[fit=(descramble1) (gtx0) (align1),draw,label=receiver] (receiver) {};

                \node[circle,left=of mux.north,draw] (adder) {$+$};
                \draw[-latex] (mux) -- (adder);

                \node[draw,left=of adder] (memory) {memory};
                \draw[-latex] (adder) -- (memory);

                \draw[latex-latex] (memory.west) -- ++(-2em,0) node[coordinate] (out) {};
                \draw[-latex] (memory) -- ++(0,2em) node[coordinate] (upper) {} -| (adder);

                \node[fit=(memory) (adder) (upper),label=average\_mem,draw,inner xsep=0.5em] (average) {};
                \node[draw,anchor=west] at ($(average.south west) + (0,-2em)$) (prepare) {prepare};
                \node[draw,anchor=east] at ($(average.south east) + (0,-2em)$) (trigger) {trigger};

                \draw[-latex] (trigger) -- (average.south -| trigger);
                \draw[latex-latex] (prepare) -- (average.south -| prepare);

                \draw[-latex] (prepare) -- (trigger);
                \draw[latex-latex] (prepare) -- (prepare -| out);

                \node[draw,below=1em of trigger] (wallclk) {wallclk};
                \draw[-latex] (wallclk) -- (\currentcoordinate -| out);
                \draw[-latex] (trigger) -- (wallclk);

                \node[draw,fit=(average) (receiver) (trigger) (wallclk.north),inner ysep=2em,inner xsep=0.5em,label=inbuf] (inbuf) {};
                \draw[dashed] (inbuf.south east) ++(0.5em,-1em) -- (\currentcoordinate |- inbuf.north) -- ++(0,1em);

                \draw[dotted,-,decorate,decoration=random steps,segment length=2mm] ($(prepare)!.5!(trigger) - (0,6em)$) node[coordinate] (clk) {} |- ($(trigger.north) + (0,0.5em)$) -| ($(mux)!.5!(adder)$) -- ++(0,6em);
                \node[anchor=base east,font=\small] at (clk) {PLB clock};
                \node[anchor=base west,font=\small] at (clk) {ADC clock};
            \end{tikzpicture}
            }
        \column{.5\linewidth}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}
                \node[source] (source) {};
                \node[circle,draw,below=1em of source] (wavemul) {$\times$};
                \draw[double,-latex] (source) -- (wavemul);
                \draw[latex-] (source.west) -- ++(-2em,0) node[coordinate] (out) {};
                \draw[latex-] (wavemul.west) -- (\currentcoordinate -| out);

                \node[draw,fit=(wavemul) (source),inner xsep=0.5em,label=below:wave] (wave) {};

                \node[draw,right=4em of wavemul] (fft) {fft};
                \draw[double,-latex] (wavemul) -- (fft);

                \node[circle,draw,right=4em of fft] (mul) {$\times$};
                \node[draw,above=5em of mul] (H) {H};
                \draw[double,latex-latex] (H) -- (\currentcoordinate -| out);

                \draw[double,-latex] (H) -- (mul);
                \draw[double,-latex] (fft) -- (mul);

                \node[draw,right=of mul] (scratch) {scratch};
                \draw[double,-latex] (mul) -- (scratch);
                \draw[double,-latex] (scratch.east) -| ++(1em,2em) -| ($(fft.west) - (1em,0)$) -- (fft);

                \node[circle,draw,below=1em of scratch] (add) {$+$};

                \draw[double,-latex] (scratch.east) -- ++(1em,0) node[coordinate] (r) {} |- (add);
                \draw[double,-latex] (fft.east) -- ++(2em,0) |- (add);
                \draw[double,-latex] (fft.east) -- ++(2em,0) -- (\currentcoordinate |- add) -| ($(mul.east)!.5!(scratch.west)$) -- (scratch);

                \draw[double,-latex] (add.south) -- ++(0,-1em) node[coordinate] (d) {} -- (\currentcoordinate -| out);
                \draw[double,latex-latex] (scratch) -- ($(mul.east)!.5!(scratch.west)$) -- (\currentcoordinate |- d) -- (\currentcoordinate -| out);

                \node[draw,fit=(wave) (add) (scratch) (r) (d),label={[xshift=8em]overlap\_add}] (overlap) {};
                \node[draw,fit=(overlap) (H),label=core] (core) {};
            \end{tikzpicture}
            }\\\vspace{1em}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}
                \node[draw,fill=white] (mem0) {mem\_0};
                \node[draw,below=of mem0,fill=white] (mem1) {mem\_1};
                \node[coordinate] at ($(mem0.west)+(-4em,0)$) (out) {};

                \draw[double] ($(mem0.west)-(1em,0)$) -- ($(mem1.west)-(2em,0)$)  node[coordinate] (out2) {};
                \draw[double] ($(mem1.west)-(1em,0)$) -- ($(mem0.west)-(2em,0)$);
                \draw[double,latex-latex] (mem0.west) -- (out);
                \draw[double,latex-latex] (mem1) -- (mem1 -| out);

                \node[trapezium,minimum height=1em,rotate=-90,anchor=center,draw] at ($(mem0.south east)!0.5!(mem1.north east) + (3em,0)$) (mux) {};

                \draw[double,-latex] (mem0.east) -| ([yshift=0.5em]$(mux.south) - (1em,0)$) -- ([yshift=0.5em]mux.south);
                \draw[double,-latex] (mem1.east) -| ([yshift=-0.5em]$(mux.south) - (1em,0)$) -- ([yshift=-0.5em]mux.south);

                \node[circle,draw,right=of mux.north] (mul) {$\times$};
                \draw[double,-latex] (mux) -- (mul);
                \draw[double,latex-] (mul.south) -- ++(0,-3em) node[coordinate] (r) {} -- (\currentcoordinate -| out);

                \node[draw,right=of mul] (transmitter) {transmitter};
                \draw[double,-latex] (mul) -- (transmitter);
                \draw[double,-latex] (transmitter.east) -- ++(2em,0);

                \node[draw,fit=(mem0) (r) (transmitter) (out2),inner xsep=0.5em,label=outbuf] (outbuf) {};
                \draw[dashed] (outbuf.south east) ++(0.5em,-1em) -- (\currentcoordinate |- outbuf.north) -- ++(0,1em);

                {[on background layer]
                    \draw[dotted,-,decorate,decoration=random steps,segment length=2mm] ($(mem0.center) - (0,8em)$) node[coordinate] (clk) {} -- ($(mem0.center) + (0,3em)$);
                    \node[anchor=base east,font=\small] at (clk) {PLB clock};
                    \node[anchor=base west,font=\small] at (clk) {ADC clock};
                }
            \end{tikzpicture}
            }
    \end{columns}
\end{frame}

\begin{frame}{Overlap Add}
    \begin{columns}
        \column{.5\linewidth}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}[gray]
                \node[draw,black] (wave) {wave};
                \draw[latex-,red] (wave.west) -- ++(-1em,0) node[coordinate] (out) {} node[left] {$x$};

                \node[draw,right=2em of wave,black] (fft) {fft};

                \node[circle,draw,right=2em of fft] (mul) {$\times$};
                \node[coordinate,above=1.5em of mul] (u) {};
                \node[above=3em of mul] (H) {$H$};

                \draw[double] (H) -- (mul);
                \draw[double] (fft) -- (mul);

                \node[draw,right=of mul] (scratch) {scratch};
                \draw[double] (mul) -- (scratch);
                \draw[double] (scratch.east) -| ++(1em,2em) -| ($(fft.west) - (1em,0)$) -- (\currentcoordinate |- fft);

                \node[circle,draw,below=1em of scratch] (add) {$+$};

                \draw[double] (scratch.east) -- ++(1em,0) node[coordinate] (r) {} |- (add);
                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) |- (add);
                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) -- (\currentcoordinate |- add) -| ($(mul.east)!.5!(scratch.west)$) -- (scratch);

                \draw[double] (add.south) -- ++(0,-1em) node[coordinate] (d) {} -- (\currentcoordinate -| out) node[left] {$y$};
                \draw[double] (scratch) -- ($(mul.east)!.5!(scratch.west)$) -- (\currentcoordinate |- d) -- (\currentcoordinate -| out);

                \node[draw,fit=(wave) (add) (scratch) (r) (d) (u),inner xsep=0.5em,black] (overlap) {};
                \node[black,anchor=south east] at (overlap.north east) {overlap\_add};
                \draw[double,-latex,red] (wave) -- (fft);
            \end{tikzpicture}
            }\\\vspace{1em}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}[gray]
                \node[draw] (wave) {wave};
                \draw[latex-] (wave.west) -- ++(-1em,0) node[coordinate] (out) {} node[left] {$x$};

                \node[draw,right=2em of wave,black] (fft) {ifft};
                \draw[double] (wave) -- ($(fft.west) - (1em,0)$);

                \node[circle,draw,right=2em of fft] (mul) {$\times$};
                \node[coordinate,above=1.5em of mul] (u) {};
                \node[above=3em of mul] (H) {$H$};

                \draw[double] (H) -- (mul);
                \draw[double] (fft) -- (mul);

                \node[draw,right=of mul,black] (scratch) {scratch};
                \draw[double] (mul) -- ($(mul.east)!.5!(scratch.west)$);

                \node[circle,draw,below=1em of scratch] (add) {$+$};

                \draw[double] (scratch.east) -- ++(1em,0) node[coordinate] (r) {} |- (add);
                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) |- (add);
                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) -- (\currentcoordinate |- add) -| ($(mul.east)!.5!(scratch.west)$);

                \draw[double] (add.south) -- ++(0,-1em) node[coordinate] (d) {} -- (\currentcoordinate -| out) node[left,blue] {$y$};
                \draw[double,latex-,blue] (scratch) -- ($(mul.east)!.5!(scratch.west)$) -- (\currentcoordinate |- d) -- (\currentcoordinate -| out);

                \node[draw,fit=(wave) (add) (scratch) (r) (d) (u),inner xsep=0.5em,black] (overlap) {};
                \node[black,anchor=south east] at (overlap.north east) {overlap\_add};
                \draw[double,-latex,red] (scratch.east) -| ++(1em,2em) -| ($(fft.west) - (1em,0)$) -- (fft);
            \end{tikzpicture}
            }
        \column{.5\linewidth}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}[gray]
                \node[draw] (wave) {wave};
                \draw (wave.west) -- ++(-1em,0) node[coordinate] (out) {} node[left] {$x$};

                \node[draw,right=2em of wave,black] (fft) {fft};
                \draw[double] (wave) -- (fft);

                \node[circle,draw,right=2em of fft,black] (mul) {$\times$};
                \node[coordinate,above=1.5em of mul] (u) {};
                \node[above=3em of mul,red] (H) {$H$};

                \node[draw,right=of mul,black] (scratch) {scratch};
                \draw[double] (scratch.east) -| ++(1em,2em) -| ($(fft.west) - (1em,0)$) -- (fft);

                \node[circle,draw,below=1em of scratch] (add) {$+$};

                \draw[double] (scratch.east) -- ++(1em,0) node[coordinate] (r) {} |- (add);
                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) |- (add);
                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) -- (\currentcoordinate |- add) -| ($(mul.east)!.5!(scratch.west)$);

                \draw[double] (add.south) -- ++(0,-1em) node[coordinate] (d) {} -- (\currentcoordinate -| out) node[left] {$y$};
                \draw[double] ($(mul.east)!.5!(scratch.west)$) -- (\currentcoordinate |- d) -- (\currentcoordinate -| out);

                \node[draw,fit=(wave) (add) (scratch) (r) (d) (u),inner xsep=0.5em,black] (overlap) {};
                \node[black,anchor=south east] at (overlap.north east) {overlap\_add};
                \draw[double,-latex,red] (fft) -- (mul);
                \draw[double,-latex,red] (mul) -- (scratch);
                \draw[double,-latex,red] (H) -- (mul);
            \end{tikzpicture}
            }\\\vspace{1em}
            \resizebox{\linewidth}{!}{
            \begin{tikzpicture}[gray]
                \node[draw] (wave) {wave};
                \draw[latex-] (wave.west) -- ++(-1em,0) node[coordinate] (out) {} node[left] {$x$};

                \node[draw,right=2em of wave,black] (fft) {ifft};
                \draw[double] (wave) -- (fft);

                \node[circle,draw,right=2em of fft] (mul) {$\times$};
                \node[coordinate,above=1.5em of mul] (u) {};
                \node[above=3em of mul] (H) {$H$};

                \draw[double] (H) -- (mul);
                \draw[double] (fft) -- (mul);

                \node[draw,right=of mul,black] (scratch) {scratch};
                \draw[double] (mul) -- (scratch);
                \draw[double] (scratch.east) -| ++(1em,2em) -| ($(fft.west) - (1em,0)$) -- (fft);

                \node[circle,draw,below=1em of scratch,black] (add) {$+$};

                \draw[double] (fft.east) -- ($(fft.east)!.5!(mul.west)$) -- (\currentcoordinate |- add) -| ($(mul.east)!.5!(scratch.west)$) -- (scratch);

                \draw[double,-latex,red] (scratch.east) -- ++(1em,0) node[coordinate] (r) {} |- (add);
                \draw[double,-latex,red] (add.south) -- ++(0,-1em) node[coordinate] (d) {} -- (\currentcoordinate -| out) node[left] {$y$};
                \node[draw,fit=(wave) (add) (scratch) (r) (d) (u),inner xsep=0.5em,black] (overlap) {};
                \draw[double] (scratch) -- ($(mul.east)!.5!(scratch.west)$) -- (\currentcoordinate |- d);
                \node[black,anchor=south east] at (overlap.north east) {overlap\_add};
                \draw[double,-latex,red] (fft.east) -- ($(fft.east)!.5!(mul.west)$) |- (add);
            \end{tikzpicture}
            }
    \end{columns}
\end{frame}

\begin{frame}{Architecture}
    \resizebox{\linewidth}{!}{
    \begin{tikzpicture}
        \tikzset{module/.style={fill=Pastel1-8-1}}
        \tikzset{interface/.style={fill=Pastel1-8-2}}
        \tikzset{cpu/.style={fill=Pastel1-8-3}}
        \tikzset{kernel/.style={fill=Pastel1-8-4}}
        \tikzset{software/.style={fill=Pastel1-8-5}}
        \tikzset{digital/.style={fill=Pastel1-8-6}}
        \tikzset{pc/.style={fill=Pastel1-8-7}}
        \tikzset{os/.style={fill=Pastel1-8-8}}

        \node[anchor=base west,inner xsep=.5em] at (0,0) (digital) {Digital Part};
        \node[anchor=base west,inner xsep=.5em] at (digital.base east) (interface) {Interface};
        \node[anchor=base west,inner xsep=.5em] at (interface.base east) (cpu) {Processor};

        \draw (digital.south west) rectangle (cpu.north east);

        \node [anchor=south] at (interface.north) (module) {\parbox[t]{1.5cm}{\centering Kernel Module}};
        \node [anchor=south west] at (module.north east) (kernel) {Kernel};

        \draw (interface.north west) -- (interface.west |- kernel.north) node[coordinate] (nw) {} -- (cpu.east |- kernel.north) node[coordinate] (ne) {} -- (cpu.north east);
        \draw (interface.west |- module.north) -| (interface.north east);

        \node [anchor=south] at ($(nw)!.5!(ne)$) (software) {Daemon};

        \draw (nw) -- (nw |- software.north) -| (ne);

        \draw ($(cpu.east |- digital.south) + (2cm,0)$) node[coordinate] (pcw) {} let \p1 = ($(ne |- software.north) - (interface.west |- digital.south)$) in rectangle ++(3.5cm,\y1) node[coordinate] (pce) {};

        \node[coordinate] at ($(pcw)!.5!(pce)$) (pcs) {};

        \node at (cpu.east -| pcs) (pc) {PC};
        \node at (software.east -| pcs) (matlab) {Matlab};
        \node at ($(pc)!.5!(matlab)$) {OS};

        \draw (cpu.north -| pcw) -- (\currentcoordinate -| pce);
        \draw (ne -| pcw) -- (\currentcoordinate -| pce);

        \begin{scope}[on background layer]
            \foreach \what in {digital,interface,cpu}
            {
                \fill[\what] (\what.west |- digital.south) rectangle (\what.east |- cpu.north);
            }
            \fill[kernel] (interface.north west) rectangle (cpu.east |- kernel.north);
            \fill[module] (interface.north west) rectangle (interface.east |- module.north);
            \fill[software] (nw) rectangle (ne |- software.north);
            \fill[pc] (pcw) rectangle (pce |- cpu.north);
            \fill[os] (pcw |- cpu.north) rectangle (pce |- ne);
        \end{scope}
        \draw[thick] (digital.east -| ne) -- ++(2cm,0);
        \draw[latex-latex] ($(digital.east)-(0.5em,0)$) -- ++(0.8em,0) -- (\currentcoordinate |- software.center);
        \draw[latex-] ($(ne |- software.center)-(0.3em,0)$) |- (digital.east -| ne);
        \draw[-latex] ($(digital.east -| ne)+(2cm,0)$) -- ++(0.3em,0) -- (\currentcoordinate |- software.center);

        \node[anchor=south,font=\small] at ($(digital.east -| ne) + (1cm,0)$) {Ethernet};

        \node[coordinate] at ($(digital.south west)-(3pt,0)$) (desc) {};

        \begin{scope}[every path/.style={decorate,decoration={brace,amplitude=3pt}}]
            \draw (desc) -- (\currentcoordinate |- digital.north) node[midway,left,xshift=-2pt] {Hardware};
            \draw (desc |- digital.north) -- (\currentcoordinate |- software.north) node[midway,left,xshift=-2pt] {Software};
        \end{scope}
    \end{tikzpicture}
    }
\end{frame}

\begin{frame}{Web Interface}
    \includegraphics[width=\textwidth]{webinterface}
\end{frame}

\begin{frame}{Uncalibrated and calibrated filter transfer functions.}
    \begin{tikzpicture}
        \pgfplotstableread{testdata/filter/H.data}\Horig
        \pgfplotstableread{testdata/filter/0.5,-45/H.data}\Hone
        \pgfplotstableread{testdata/filter/0.5,135/H.data}\Htwo
        \begin{axis}[
                legend style={at={(0.5,0.03)},anchor=south,cells={anchor=west}},
                ylabel={$\abs{H}$},
                y unit={1},
                xlabel={frequency},
                x unit={\Hz},
                change x base,
                x SI prefix=mega,
                xmin = -50e6,
                xmax = 50e6,
                width=0.95\linewidth,
                height=7cm,
            ]
            \addplot[blue,line join=bevel] table[x index=0,y index=1] {\Horig};
            \addlegendentry{Low pass}
            \addplot[green,line join=bevel] table[x index=0,y index=1] {\Hone};
            \addlegendentry{$0.5 \angle \SI{-45}{\degree}$}
            \addplot[red,line join=bevel] table[x index=0,y index=1] {\Htwo};
            \addlegendentry{$0.5 \angle \SI{135}{\degree}$}
        \end{axis}
    \end{tikzpicture}
\end{frame}

\begin{frame}{Phase drift of $\Gamma_L$}
    \begin{tikzpicture}
        \begin{axis}[
                ylabel={angle},
                y unit={\degree},
                xlabel={time},
                x unit={\minute}, %change xbase
                width=.95\linewidth,
                x filter/.expression={x/60},
                xmin=0,
                xmax=1000,
                height=7cm
            ]
            \addplot[blue,line join=bevel] table {testdata/phase/single.data};
        \end{axis}
    \end{tikzpicture}
\end{frame}
\backupend
\end{document}

