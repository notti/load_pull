%
\documentclass[11pt]{article}
\usepackage{register}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[pdf]{pstricks}
\usepackage{pst-circ}
\begin{document}

\title{}
\author{Gernot Vormayr}
\date{}
\maketitle
blah
\begin{register}{htbp}{reg(0)}{0x00}%
\label{reg0}%
\regfield{rec\_rst}{1}{31}{0}%
\regfield{Reserved}{4}{27}{0}%
\regfield{rec\_stream\_valid}{1}{26}{0}%
\regfield{rec\_input\_select}{2}{24}{0}%
\regfield{Reserved}{2}{22}{0}%
\regfield{rec\_data\_valid(3)}{1}{21}{0}%
\regfield{rec\_rxeqmix(3)}{2}{19}{0}%
\regfield{rec\_descramble(3)}{1}{18}{1}%
\regfield{rec\_polarity(3)}{1}{17}{1}%
\regfield{rec\_enable(3)}{1}{16}{1}%
\regfield{Reserved}{2}{14}{0}%
\regfield{rec\_data\_valid(1)}{1}{13}{0}%
\regfield{rec\_rxeqmix(1)}{2}{11}{0}%
\regfield{rec\_descramble(1)}{1}{10}{1}%
\regfield{rec\_polarity(1)}{1}{9}{1}%
\regfield{rec\_enable(1)}{1}{8}{1}%
\regfield{Reserved}{2}{6}{0}%
\regfield{rec\_data\_valid(0)}{1}{5}{0}%
\regfield{rec\_rxeqmix(0)}{2}{3}{0}%
\regfield{rec\_descramble(0)}{1}{2}{1}%
\regfield{rec\_polarity(0)}{1}{1}{1}%
\regfield{rec\_enable(0)}{1}{0}{1}%
\reglabel{Reset}\regnewline%
\end{register}
\begin{register}{htbp}{reg(1)}{0x04}%
\label{reg1}%
\regfield{avg\_rst}{1}{31}{0}%
\regfield{Reserved}{3}{28}{0}%
\regfield{avg\_err}{1}{27}{0}%
\regfield{avg\_active}{1}{26}{0}%
\regfield{avg\_width}{2}{24}{0}%
\regfield{trig\_rst}{1}{23}{0}%
\regfield{Reserved}{3}{19}{0}%
\regfield{trig\_int}{1}{19}{0}%
\regfield{trig\_arm}{1}{18}{0}%
\regfield{Reserved}{1}{17}{0}%
\regfield{trig\_type}{1}{16}{0}%
\regfield{depth}{16}{0}{0}%
\reglabel{Reset}\regnewline%
\end{register}
\begin{register}{htbp}{reg(2)}{0x08}%
\label{reg2}%
\regfield{Reserved}{4}{28}{0}%
\regfield{core\_scale\_schi}{12}{16}{0}%
\regfield{Reserved}{4}{12}{0}%
\regfield{core\_scale\_sch}{12}{0}{0}%
\reglabel{Reset}\regnewline%
\end{register}
\begin{register}{htbp}{reg(3)}{0x0C}%
\label{reg3}%
\regfield{core\_rst}{1}{31}{0}%
\regfield{Reserved}{2}{29}{0}%
\regfield{core\_ov\_cmul}{1}{28}{0}%
\regfield{core\_ov\_ifft}{1}{27}{0}%
\regfield{core\_ov\_fft}{1}{26}{0}%
\regfield{core\_start}{1}{25}{0}%
\regfield{core\_iq}{1}{24}{0}%
\regfield{Reserved}{3}{21}{0}%
\regfield{core\_n}{5}{16}{0}%
\regfield{core\_cmul\_sch}{2}{14}{0}%
\regfield{Reserved}{2}{12}{0}%
\regfield{core\_L}{12}{0}{0}%
\reglabel{Reset}\regnewline%
\end{register}
\begin{register}{htbp}{reg(4)}{0x10}%
\label{reg4}%
\regfield{tx\_mulq}{16}{16}{0}%
\regfield{tx\_muli}{16}{0}{0}%
\reglabel{Reset}\regnewline%
\end{register}
\begin{register}{htbp}{reg(5)}{0x14}%
\label{reg5}%
\regfield{tx\_shift}{1}{31}{0}%
\regfield{tx\_ovfl}{1}{30}{0}%
\regfield{Reserved}{5}{25}{0}%
\regfield{mem\_req}{1}{24}{0}%
\regfield{tx\_rst}{1}{23}{0}%
\regfield{Reserved}{3}{20}{0}%
\regfield{tx\_resync}{1}{19}{0}%
\regfield{tx\_toggle}{1}{18}{0}%
\regfield{tx\_dc\_balance}{1}{17}{0}%
\regfield{tx\_deskew}{1}{16}{0}%
\regfield{tx\_frame\_offset}{16}{0}{0}%
\reglabel{Reset}\regnewline%
\end{register}

\begin{pspicture}[showgrid](0,0)(10,10)
\SpecialCoor
\rput(0,4)
{
    \rput[tr](9.9,3.3){inbuf}
    \pnode(0,0.2){inbufCtrl}
    \pnode(0,2){inbufData}
    \pnode(3.7,2){inbufDataMux}
    \rput(0.2,1.4)
    {
        \rput[tr](2.9,1.4){average\_mem}
        \rput(1.5,0.4){\psframebox[fillstyle=solid]{mem}}
        \psframe(0,0)(3,1.5)
    }
    \rput(4,2)
    {
        \rput[tr](5.7,0.8){receiver}
        \multido{\i=2+-1,\n=0.1+-0.1}{3}
        {
            \rput(\n,\n)
            {
                {
                    \psset{fillstyle=solid}
                    \rput[l](0.3,0){\rnode{descramble\i}{\psframebox{descramble}}}
                    \rput(3.5,0){\rnode{GTX\i}{\psframebox{GTX}}}
                    \rput(5,0){\rnode{align\i}{\psframebox{align}}}
                }
                \pnode(!\n\space neg -0.2 add 0){inbufDataMUX\i}
                \ncline[linecolor=blue]{GTX\i}{descramble\i}
                \ncline[linecolor=blue]{descramble\i}{inbufDataMUX\i}
                \psset{linecolor=red}
                \ncline{align\i}{GTX\i}
                \ncangle[angleA=-90, armB=0]{align\i}{inbufCtrl}
                \ncangle[angleA=-90, armB=0]{GTX\i}{inbufCtrl}
                \ncangle[angleA=-90, armB=0]{descramble\i}{inbufCtrl}
            }
        }
        \psframe(0,-0.6)(5.8,0.9)
    }
    {
        \psset{fillstyle=solid}
        \rput[l](2.1,0.7){\rnode{wallclk}{\psframebox{wallclk}}}
        \rput[r](1.6,0.7){\rnode{trigger}{\psframebox{trigger}}}
        \pnode(1.9,1.4){averageMemCtrl}
        \pnode(0.2,2){averageMemDataOut}
        \pnode(3.2,2){averageMemDataIn}
    }
    \ncline[linecolor=blue]{inbufDataMux}{averageMemDataIn}
    {
        \psset{linecolor=red}
        \ncangle[angleA=-90, angleB=180, armB=0, offset=2pt]{averageMemCtrl}{wallclk}
        \ncangle[angleA=-90, armB=0, offset=-2pt]{averageMemCtrl}{trigger}
        \ncangle[angleA=-90, armB=0]{averageMemCtrl}{inbufCtrl}
        \ncangle[angleA=-90, armB=0]{trigger}{inbufCtrl}
        \ncangle[angleA=-90, armB=0]{wallclk}{inbufCtrl}
        \ncangle[angleA=-90, armB=0]{inbufDataMux}{inbufCtrl}
    }
    \rput(3.6,1.65){\pspolygon[fillcolor=white,fillstyle=solid](0,0.15)(0.2,0)(0.2,0.7)(0,0.55)}
    \ncline[linecolor=green]{averageMemDataOut}{inbufData}
    \psframe(0,0)(10,3.4)
}
%core
% h
% overlap_add
%  fftncmul
%   cmul
%  ifftnadd
%  fft
%  scratch
%outbuf
% mem
% mem
% mux
% cmul
% transmitter
%  balance
\end{pspicture}
\end{document}
